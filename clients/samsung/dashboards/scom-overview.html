<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Samsung HE AI Visibility and Performance Dashboard</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="./js/supabase-data.js"></script>
    <style>
/* === base/fonts.html === */
@font-face {
    font-family: 'Samsung Sharp Sans';
    src: url('./fonts/SamsungSharpSansBd.woff2') format('woff2'),
         url('./fonts/SamsungSharpSans-Bold.ttf') format('truetype');
    font-weight: 700;
}
@font-face {
    font-family: 'Samsung One';
    src: url('./fonts/SamsungOneLatinWeb-400.woff2') format('woff2'),
         url('./fonts/SamsungOneLatinCompact-400.ttf') format('truetype');
    font-weight: 400;
}
/* === base/tokens.html === */
:root {
    /* Brand */
    --color-primary: #1428A0;
    --color-primary-light: #8091df;

    /* Accent Palette */
    --color-accent-blue: #0277c6;
    --color-accent-cyan: #02b2e4;
    --color-accent-teal: #01c3b0;
    --color-accent-purple: #8091df;
    --color-accent-green: #96d551;
    --color-accent-yellow: #feb447;
    --color-accent-red: #ff4438;

    /* Semantic */
    --color-success: #4caf50;
    --color-error: #f44336;
    --color-neutral: #9e9e9e;

    /* Backgrounds */
    --color-bg-page: #f8f9fa;
    --color-bg-header: #f7f7f7;
    --color-bg-card: #ffffff;
    --color-bg-success: #e8f5e9;
    --color-bg-error: #ffebee;

    /* Text */
    --color-text-primary: #000000;
    --color-text-secondary: #666666;
    --color-text-link: #1428A0;

    /* Borders */
    --color-border: #e0e0e0;
    --color-border-accent: #1428A0;

    /* Competitor brands */
    --color-brand-samsung: #1428A0;
    --color-brand-lg: #A50034;
    --color-brand-sony: #000000;
    --color-brand-tcl: #E31937;
    --color-brand-hisense: #00A0DF;
    --color-brand-xbox: #107C10;
    --color-brand-roku: #6C3C97;

    /* Typography */
    --font-display: 'Samsung Sharp Sans', sans-serif;
    --font-body: 'Samsung One', -apple-system, sans-serif;
    --font-size-xs: 11px;
    --font-size-sm: 12px;
    --font-size-base: 14px;
    --font-size-md: 16px;
    --font-size-lg: 18px;
    --font-size-xl: 24px;
    --font-size-2xl: 28px;
    --font-size-3xl: 32px;
    --font-size-metric: 42px;
    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-bold: 700;
    --line-height-tight: 1.1;
    --line-height-normal: 1.5;

    /* Spacing */
    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 12px;
    --spacing-lg: 16px;
    --spacing-xl: 20px;
    --spacing-2xl: 24px;

    /* Layout */
    --max-width: 1400px;
    --header-logo-height: 36px;

    /* Radius */
    --radius-sm: 4px;
    --radius-md: 6px;
    --radius-lg: 8px;
    --radius-xl: 12px;

    /* Shadows */
    --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: var(--font-body);
    background: var(--color-bg-page);
    color: var(--color-text-primary);
}

.container {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: var(--spacing-2xl);
}
/* === base/components.html === */
/* ===========================================
   GLOBAL COMPONENTS
   Shared styles used across multiple templates
   =========================================== */

/* -----------------------------------------
   TOOLTIP (Help Icon)
   Usage: <div class="tooltip-icon"><span>?</span><div class="tooltip-text">...</div></div>
   ----------------------------------------- */
.tooltip-icon {
    width: 18px;
    height: 18px;
    background: var(--color-accent-purple);
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: help;
    position: relative;
    flex-shrink: 0;
}

.tooltip-icon span {
    color: white;
    font-size: 12px;
    font-weight: 700;
    line-height: 1;
}

.tooltip-text {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    top: 24px;
    right: 0;
    width: 200px;
    background: #333;
    color: white;
    font-family: var(--font-body);
    font-size: 12px;
    font-weight: 400;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    line-height: 1.4;
    text-align: left;
    z-index: 100;
    transition: opacity 0.2s, visibility 0.2s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.tooltip-text::before {
    content: '';
    position: absolute;
    top: -6px;
    right: 8px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid #333;
}

.tooltip-icon:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

/* Tooltip positioned to the left (for right-aligned elements) */
.tooltip-icon.tooltip-left .tooltip-text {
    right: auto;
    left: 0;
}

.tooltip-icon.tooltip-left .tooltip-text::before {
    right: auto;
    left: 8px;
}

/* Tooltip positioned center */
.tooltip-icon.tooltip-center .tooltip-text {
    right: auto;
    left: 50%;
    transform: translateX(-50%);
}

.tooltip-icon.tooltip-center .tooltip-text::before {
    right: auto;
    left: 50%;
    transform: translateX(-50%);
}

/* -----------------------------------------
   CHANGE BADGES
   Usage: <span class="change-badge increase">+54</span>
   ----------------------------------------- */
.change-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    border-radius: 20px;
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 600;
}

.change-badge.increase {
    background: rgba(255, 68, 56, 0.1);
    color: var(--color-accent-red);
}

.change-badge.decrease {
    background: rgba(150, 213, 81, 0.2);
    color: #2e7d32;
}

.change-badge.neutral {
    background: rgba(0, 0, 0, 0.05);
    color: var(--color-text-secondary);
}

/* Inverted: when increase is good, decrease is bad */
.change-badge.increase-good {
    background: rgba(150, 213, 81, 0.2);
    color: #2e7d32;
}

.change-badge.decrease-bad {
    background: rgba(255, 68, 56, 0.1);
    color: var(--color-accent-red);
}

.change-badge .arrow {
    font-size: 12px;
}
/* -----------------------------------------
   KPI CARD BASE STYLES
   Two variants: Header (large with icon) and Compact (stacked sections)
   ----------------------------------------- */

/* Base card styling shared by all KPI cards */
.kpi-card-base {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    position: relative;
}

/* HEADER KPI - Large cards with icons, used at top of dashboard
   Usage: .kpi-card-header
   Dimensions: 160px min-height, centered content, icon above value */
.kpi-card-header {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    min-height: 160px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    position: relative;
}

.kpi-card-header .kpi-icon {
    width: 64px;
    height: 64px;
    margin-bottom: var(--spacing-md);
    object-fit: contain;
}

.kpi-card-header .kpi-label {
    font-family: var(--font-display);
    font-size: var(--font-size-xs);
    text-transform: uppercase;
    color: var(--color-text-secondary);
    letter-spacing: 0.5px;
    font-weight: 700;
    margin-bottom: var(--spacing-xs);
}

.kpi-card-header .kpi-value {
    font-family: var(--font-display);
    font-size: var(--font-size-metric);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    line-height: var(--line-height-tight);
}

.kpi-card-header .change-badge {
    margin-top: var(--spacing-xs);
}

/* COMPACT KPI - Side-by-side layout, no icon, used for secondary metrics
   Usage: .kpi-card-compact
   Dimensions: auto height, horizontal label/value pairs */
.kpi-card-compact {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    overflow: hidden;
}

.kpi-card-compact .kpi-section {
    padding: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.kpi-card-compact .kpi-section:not(:last-child) {
    border-bottom: 1px solid var(--color-border);
}

.kpi-card-compact .kpi-section-left {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.kpi-card-compact .kpi-section-label {
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 400;
    color: var(--color-text-secondary);
}

.kpi-card-compact .kpi-section-right {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.kpi-card-compact .kpi-value {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
    line-height: 1;
}

/* SINGLE KPI - One metric in a horizontal row, no stacking
   Usage: .kpi-card-single
   Dimensions: auto height, single row with label left, value right */
.kpi-card-single {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.kpi-card-single .kpi-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 400;
    color: var(--color-text-secondary);
}

.kpi-card-single .kpi-metrics {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.kpi-card-single .kpi-value {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
    line-height: 1;
}

/* DUAL KPI - Two metrics side-by-side with divider
   Usage: .kpi-card-dual
   Dimensions: 160px min-height, centered with vertical divider */
.kpi-card-dual {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    min-height: 160px;
    display: flex;
    flex-direction: column;
    position: relative;
}

.kpi-card-dual .kpi-label {
    font-family: var(--font-display);
    font-size: var(--font-size-xs);
    text-transform: uppercase;
    color: var(--color-text-secondary);
    letter-spacing: 0.5px;
    font-weight: 700;
    text-align: center;
    margin-bottom: var(--spacing-md);
}

.kpi-dual-metrics {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--spacing-lg);
    flex: 1;
}

.kpi-dual-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.kpi-dual-item-label {
    font-family: var(--font-display);
    font-size: var(--font-size-xs);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 700;
    margin-bottom: var(--spacing-xs);
}

.kpi-dual-item.with .kpi-dual-item-label,
.kpi-dual-item.with .kpi-dual-item-value {
    color: var(--color-accent-green);
}

.kpi-dual-item.without .kpi-dual-item-label,
.kpi-dual-item.without .kpi-dual-item-value {
    color: var(--color-accent-red);
}

.kpi-dual-item-value {
    font-family: var(--font-display);
    font-size: var(--font-size-metric);
    font-weight: var(--font-weight-bold);
    line-height: var(--line-height-tight);
}

.kpi-dual-item .change-badge {
    margin-top: var(--spacing-xs);
}

.kpi-dual-divider {
    width: 1px;
    height: 50px;
    background: var(--color-border);
}

/* DONUT KPI - Donut chart with legend
   Usage: .kpi-card-donut
   Dimensions: 160px min-height, chart left, legend right */
.kpi-card-donut {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    min-height: 160px;
    display: flex;
    flex-direction: column;
    position: relative;
}

.kpi-card-donut .kpi-label {
    font-family: var(--font-display);
    font-size: var(--font-size-xs);
    text-transform: uppercase;
    color: var(--color-text-secondary);
    letter-spacing: 0.5px;
    font-weight: 700;
    text-align: center;
    margin-bottom: var(--spacing-sm);
}

.kpi-donut-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-lg);
    flex: 1;
}

.kpi-donut-chart {
    position: relative;
    width: 100px;
    height: 100px;
}

.kpi-donut-chart svg {
    transform: rotate(-90deg);
    overflow: visible;
}

.kpi-donut-chart svg circle {
    cursor: pointer;
    transition: transform 0.2s ease, filter 0.2s ease;
    transform-origin: 50px 50px;
}

.kpi-donut-chart svg circle:hover {
    transform: scale(1.08);
    filter: brightness(1.1) drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.kpi-donut-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

.kpi-donut-total {
    font-family: var(--font-display);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    line-height: 1;
}

.kpi-donut-total-label {
    font-size: 9px;
    color: var(--color-text-secondary);
    text-transform: uppercase;
}

.kpi-donut-legend {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.kpi-donut-legend-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 12px;
}

.kpi-donut-legend-color {
    width: 10px;
    height: 10px;
    border-radius: 2px;
}

.kpi-donut-legend-color.pos1 { background: var(--color-accent-green); }
.kpi-donut-legend-color.pos2 { background: var(--color-accent-blue); }
.kpi-donut-legend-color.pos3 { background: var(--color-accent-yellow); }
.kpi-donut-legend-color.pos4 { background: var(--color-accent-red); }

.kpi-donut-legend-value {
    font-weight: 700;
    min-width: 24px;
}

.kpi-donut-legend-label {
    color: var(--color-text-secondary);
}

/* KPI Row layouts */
.kpi-row-4 {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
}

.kpi-row-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
}

.kpi-row-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
}

/* -----------------------------------------
   PLATFORM ICONS
   Usage: <div class="platform-icon chatgpt">C</div>
   ----------------------------------------- */
.platform-icon {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 700;
    color: white;
}

.platform-icon.chatgpt { background: #10a37f; }
.platform-icon.perplexity { background: #1a7f64; }
.platform-icon.gemini { background: #8e44ad; }
.platform-icon.copilot { background: #0078d4; }
.platform-icon.google-ai-mode { background: #4285f4; }
.platform-icon.google-ai-overview { background: #ea4335; }
.platform-icon.grok { background: #000000; }
.platform-icon.deepseek { background: #5865f2; }
.platform-icon.all-models { background: #333333; }

/* Model icon variant (circular, larger) */
.model-icon {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: white;
}

.model-icon.chatgpt { background: #10a37f; }
.model-icon.gemini { background: #4285f4; }
.model-icon.perplexity { background: #1a1a2e; }
.model-icon.ai-overview { background: #ea4335; }

/* -----------------------------------------
   BAR VISUALIZATION
   Usage: <div class="bar-cell"><div class="bar-container"><div class="bar-fill" style="width: 72%"></div></div><span class="bar-value">72%</span></div>
   ----------------------------------------- */
.bar-cell {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
}

.bar-container {
    width: 60px;
    height: 8px;
    background: #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
}

.bar-fill {
    height: 100%;
    background: var(--color-primary);
    border-radius: 4px;
}

.bar-value {
    font-weight: 600;
    min-width: 45px;
    text-align: right;
}

/* -----------------------------------------
   POSITION CHANGE BADGES
   Usage: <span class="position-change up">â–² 2</span>
   ----------------------------------------- */
.position-change {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.position-change.up {
    color: #10b981;
    background: rgba(16, 185, 129, 0.1);
}

.position-change.down {
    color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
}

.position-change.neutral {
    color: var(--color-text-secondary);
    background: #f3f4f6;
}

.position-change.new {
    color: var(--color-primary);
    background: rgba(20, 40, 160, 0.1);
}

.position-change.lost {
    color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
}

/* -----------------------------------------
   TABLE CARD CONTAINERS
   ----------------------------------------- */
.table-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
}

.table-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
}

.table-card-title {
    font-family: var(--font-display);
    font-size: 14px;
    font-weight: 700;
    color: #333;
    display: flex;
    align-items: center;
    gap: 6px;
}

/* Tables grid layout */
.tables-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-xl);
    margin-bottom: var(--spacing-2xl);
}

/* -----------------------------------------
   DATA TABLE BASE
   Usage: <table class="data-table">
   ----------------------------------------- */
.data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.data-table th {
    text-align: left;
    font-weight: 600;
    color: var(--color-text-secondary);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 8px 12px;
    border-bottom: 1px solid var(--color-border);
}

.data-table th:not(:first-child) {
    text-align: right;
}

.data-table td {
    padding: 10px 12px;
    border-bottom: 1px solid #f0f0f0;
    vertical-align: middle;
}

.data-table td:not(:first-child) {
    text-align: right;
}

.data-table tbody tr:last-child td {
    border-bottom: none;
}

.data-table tbody tr:nth-child(even) {
    background: #f8f9fa;
}

.data-table tbody tr:hover {
    background: #f0f1f3;
}

/* Platform name cell */
.platform-name {
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Metric value styling */
.metric-value {
    font-weight: 600;
    color: var(--color-text-primary);
}

/* -----------------------------------------
   EXPORT BUTTON
   ----------------------------------------- */
.export-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-family: var(--font-body);
    font-size: 13px;
    color: var(--color-text-primary);
    cursor: pointer;
    transition: all 0.2s;
}

.export-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

/* Download button (icon only) */
.download-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.2s;
}

.download-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

/* -----------------------------------------
   LINE CHART COMPONENTS
   Usage: .chart-card > .chart-header + .chart-content
   ----------------------------------------- */
.charts-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
}

.chart-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
}

.chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
}

.chart-title {
    font-family: var(--font-display);
    font-size: 16px;
    font-weight: 700;
    color: #333;
    display: flex;
    align-items: center;
    gap: 6px;
}

.chart-content {
    display: flex;
    gap: 16px;
}

.chart-area {
    flex: 1;
    min-width: 0;
    height: 280px;
    overflow: hidden;
}

.chart-area svg {
    width: 100%;
    height: 100%;
}

/* Chart Insights Box */
.chart-insights {
    width: 220px;
    flex-shrink: 0;
    background: #f8f9fa;
    border-radius: 8px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.insight-item {
    margin-bottom: 12px;
    opacity: 0;
    animation: fadeInUp 0.5s ease forwards;
}

.insight-item:last-child {
    margin-bottom: 0;
}

.insight-item:nth-child(1) { animation-delay: 0.2s; }
.insight-item:nth-child(2) { animation-delay: 0.6s; }
.insight-item:nth-child(3) { animation-delay: 1.0s; }

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.insight-label {
    font-size: 11px;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}

.insight-value {
    font-family: var(--font-display);
    font-size: 20px;
    font-weight: 700;
    color: var(--color-primary);
}

.insight-value.positive { color: var(--color-accent-green); }
.insight-value.negative { color: var(--color-accent-red); }

.insight-change {
    font-size: 12px;
    color: var(--color-text-secondary);
}

/* Chart Legend */
.chart-legend {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px 16px;
    margin-top: 16px;
    padding-top: 12px;
    border-top: 1px solid var(--color-border);
    margin-right: 236px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--color-text-secondary);
}

.legend-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
}

/* D3 Chart Styles */
.grid-line {
    stroke: #e8e8e8;
    stroke-width: 1;
}

.axis text {
    font-family: var(--font-body);
    font-size: 13px;
    fill: var(--color-text-secondary);
}

.axis path, .axis line {
    stroke: #ccc;
}

.data-line {
    fill: none;
    stroke-width: 2.5;
    stroke-linecap: round;
    stroke-linejoin: round;
}

.data-point {
    stroke-width: 2;
    stroke: white;
}

/* Line Chart Tooltip */
.line-chart-tooltip {
    position: absolute;
    background: #333;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 100;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.line-chart-tooltip.visible {
    opacity: 1;
}

/* -----------------------------------------
   SUNBURST CHART COMPONENTS
   Usage: .sunburst-card > .sunburst-container
   ----------------------------------------- */
.sunburst-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-2xl);
}

.sunburst-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
}

.sunburst-card .card-title {
    font-family: var(--font-display);
    font-size: 16px;
    font-weight: 700;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
}

.sunburst-container {
    display: flex;
    gap: 40px;
    align-items: flex-start;
}

.sunburst-chart {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.sunburst-details {
    flex: 1;
    min-width: 300px;
}

.sunburst-details .details-header {
    font-family: var(--font-display);
    font-size: 14px;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--color-primary);
}

.sunburst-details .selected-category {
    font-family: var(--font-display);
    font-size: 20px;
    color: var(--color-primary);
    margin-bottom: 8px;
}

.sunburst-details .selected-count {
    font-size: 14px;
    color: var(--color-text-secondary);
    margin-bottom: 16px;
}

.sunburst-details .breadcrumb {
    font-size: 12px;
    color: var(--color-text-secondary);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
}

.sunburst-details .breadcrumb-item {
    cursor: pointer;
    padding: 2px 8px;
    background: #f0f0f0;
    border-radius: 4px;
    transition: background 0.2s;
}

.sunburst-details .breadcrumb-item:hover {
    background: #e0e0e0;
}

.sunburst-details .breadcrumb-separator {
    color: #ccc;
}

.sunburst-details .prompts-list {
    max-height: 400px;
    overflow-y: auto;
}

.sunburst-details .prompt-item {
    padding: 10px 12px;
    background: #f8f9fa;
    border-radius: 6px;
    margin-bottom: 8px;
    font-size: 13px;
    color: var(--color-text-primary);
    border-left: 3px solid var(--color-primary);
}

.sunburst-details .prompt-item:hover {
    background: #f0f1f3;
}

/* Sunburst Legend */
.sunburst-card .legend {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-top: 16px;
    justify-content: center;
}

.sunburst-card .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: opacity 0.2s;
}

.sunburst-card .legend-item:hover {
    opacity: 0.7;
}

.sunburst-card .legend-color {
    width: 12px;
    height: 12px;
    border-radius: 3px;
}

/* Subcategory Chips */
.subcategory-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
}

.subcategory-chip {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    background: #f0f0f0;
    border-radius: 16px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.subcategory-chip:hover {
    background: var(--color-primary);
    color: white;
}

.subcategory-chip .chip-count {
    background: rgba(0,0,0,0.1);
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 11px;
}

.subcategory-chip:hover .chip-count {
    background: rgba(255,255,255,0.2);
}

/* Sunburst Center Label */
.center-label {
    font-family: var(--font-display);
    text-anchor: middle;
    pointer-events: none;
}

.center-total {
    font-size: 28px;
    fill: var(--color-primary);
}

.center-text {
    font-size: 12px;
    fill: var(--color-text-secondary);
}

/* Arc Hover */
.arc {
    cursor: pointer;
    transition: opacity 0.2s;
}

.arc:hover {
    opacity: 0.8;
}

/* Sunburst Segment Labels */
.segment-label {
    font-family: var(--font-body);
    font-size: 11px;
    fill: #fff;
    pointer-events: none;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

/* Sunburst Metrics Table */
.sunburst-metrics {
    flex: 1;
    min-width: 480px;
    max-height: 500px;
    overflow-y: auto;
}

.sunburst-metrics .metrics-header {
    font-family: var(--font-display);
    font-size: 14px;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--color-primary);
}

.metrics-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.metrics-table th {
    text-align: left;
    font-weight: 600;
    color: var(--color-text-secondary);
    font-size: 11px;
    text-transform: uppercase;
    padding: 10px 12px;
    border-bottom: 1px solid var(--color-border);
    white-space: nowrap;
}

.metrics-table th:not(:first-child) {
    text-align: right;
}

.metrics-table td {
    padding: 10px 12px;
    border-bottom: 1px solid #f0f0f0;
    vertical-align: middle;
}

.metrics-table td:not(:first-child) {
    text-align: right;
}

.metrics-table tbody tr {
    cursor: pointer;
    transition: background 0.15s;
}

.metrics-table tbody tr:hover {
    background: #f8f9fa;
}

.metrics-table tbody tr.selected {
    background: #e8f4fc;
}

.metrics-table .tag-name {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    color: var(--color-text-primary);
}

.metrics-table .expand-icon {
    color: var(--color-text-secondary);
    font-size: 12px;
    width: 12px;
    transition: transform 0.2s;
}

.metrics-table .expand-icon.expanded {
    transform: rotate(90deg);
}

.metrics-table .tag-color {
    width: 10px;
    height: 10px;
    border-radius: 2px;
    flex-shrink: 0;
}

.metrics-table .child-row td:first-child {
    padding-left: 36px;
}

.metrics-table .child-row .tag-name {
    font-weight: 400;
    color: var(--color-text-secondary);
}

.metrics-bar {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
}

.metrics-bar-bg {
    width: 60px;
    height: 6px;
    background: #f0f0f0;
    border-radius: 3px;
    overflow: hidden;
}

.metrics-bar-fill {
    height: 100%;
    background: #d4e5ff;
    border-radius: 3px;
    transition: width 0.3s;
}

.metrics-bar-fill.sov {
    background: linear-gradient(90deg, #a5d6a7, #66bb6a);
}

.visibility-cell {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 6px;
}

.visibility-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.visibility-dot.high {
    background: #66bb6a;
}

.visibility-dot.medium {
    background: #ffb74d;
}

.visibility-dot.low {
    background: #ef5350;
}

/* === header.html === */
header {
    background: var(--color-bg-header);
    border-bottom: 3px solid var(--color-border-accent);
    box-shadow: var(--shadow-sm);
}

.header-content {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: var(--spacing-lg) var(--spacing-2xl);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-title {
    font-family: var(--font-display);
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
}

.header-logo {
    height: var(--header-logo-height);
}
/* === kpi-cards.html === */
.kpi-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
}

.kpi-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    min-height: 160px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    position: relative;
}

.kpi-tooltip {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 18px;
    height: 18px;
    background: var(--color-accent-purple);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: help;
}

.kpi-tooltip span {
    color: white;
    font-size: 12px;
    font-weight: 700;
    line-height: 1;
}

.kpi-tooltip-text {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    top: 28px;
    right: 0;
    width: 220px;
    background: #333;
    color: white;
    font-family: var(--font-body);
    font-size: 12px;
    font-weight: 400;
    padding: 10px 12px;
    border-radius: 6px;
    line-height: 1.4;
    text-align: left;
    z-index: 100;
    transition: opacity 0.2s, visibility 0.2s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.kpi-tooltip-text::before {
    content: '';
    position: absolute;
    top: -6px;
    right: 12px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid #333;
}

.kpi-tooltip:hover .kpi-tooltip-text {
    visibility: visible;
    opacity: 1;
}

.kpi-icon {
    width: 64px;
    height: 64px;
    margin-bottom: var(--spacing-md);
    object-fit: contain;
}

.kpi-label {
    font-family: var(--font-display);
    font-size: var(--font-size-xs);
    text-transform: uppercase;
    color: var(--color-text-secondary);
    letter-spacing: 0.5px;
    font-weight: 700;
    margin-bottom: var(--spacing-xs);
}

.kpi-value {
    font-family: var(--font-display);
    font-size: var(--font-size-metric);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    line-height: var(--line-height-tight);
}

/* Change badges - uses global .change-badge from components.html */
.kpi-card .change-badge {
    margin-top: var(--spacing-xs);
}
/* === line-charts.html === */
/* Line chart template-specific tooltip positioning */
.chart-tooltip-icon {
    position: relative;
}

.chart-tooltip-icon .chart-tooltip-text {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    top: 28px;
    left: 0;
    width: 240px;
    background: #333;
    color: white;
    font-family: var(--font-body);
    font-size: 12px;
    font-weight: 400 !important;
    padding: 10px 12px;
    border-radius: 6px;
    line-height: 1.4;
    text-align: left;
    z-index: 100;
    transition: opacity 0.2s, visibility 0.2s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.chart-tooltip-icon .chart-tooltip-text::before {
    content: '';
    position: absolute;
    top: -6px;
    left: 12px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid #333;
}

.chart-tooltip-icon:hover .chart-tooltip-text {
    visibility: visible;
    opacity: 1;
}
/* === platform-tables.html === */
/* Platform Table Card */
.platform-table-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
}

.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
}

.table-title {
    font-family: var(--font-display);
    font-size: 14px;
    font-weight: 700;
    color: #333;
    display: flex;
    align-items: center;
    gap: 6px;
}

.table-tooltip-icon {
    position: relative;
    width: 18px;
    height: 18px;
    background: var(--color-accent-purple);
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: help;
    flex-shrink: 0;
}

.table-tooltip-icon span {
    color: white;
    font-size: 12px;
    font-weight: 700;
    line-height: 1;
}

.table-tooltip-text {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    top: 28px;
    left: 0;
    width: 240px;
    background: #333;
    color: white;
    font-family: var(--font-body);
    font-size: 12px;
    font-weight: 400 !important;
    padding: 10px 12px;
    border-radius: 6px;
    line-height: 1.4;
    text-align: left;
    z-index: 100;
    transition: opacity 0.2s, visibility 0.2s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.table-tooltip-text::before {
    content: '';
    position: absolute;
    top: -6px;
    left: 12px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid #333;
}

.table-tooltip-icon:hover .table-tooltip-text {
    visibility: visible;
    opacity: 1;
}

/* Platform Table */
.platform-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.platform-table th {
    text-align: left;
    font-weight: 600;
    color: var(--color-text-secondary);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 8px 12px;
    border-bottom: 1px solid var(--color-border);
}

.platform-table th:not(:first-child) {
    text-align: right;
}

.platform-table td {
    padding: 10px 12px;
    border-bottom: 1px solid #f0f0f0;
    vertical-align: middle;
}

.platform-table td:not(:first-child) {
    text-align: right;
}

.platform-table tbody tr:last-child td {
    border-bottom: none;
}

.platform-table tbody tr:nth-child(even) {
    background: #f8f9fa;
}

.platform-table tbody tr:hover {
    background: #f0f1f3;
}

/* Platform name with icon */
.platform-name {
    display: flex;
    align-items: center;
    gap: 8px;
}

.platform-icon {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 700;
    color: white;
}

.platform-icon.chatgpt { background: #10a37f; }
.platform-icon.perplexity { background: #1a7f64; }
.platform-icon.gemini { background: #8e44ad; }
.platform-icon.copilot { background: #0078d4; }
.platform-icon.google-ai-mode { background: #4285f4; }
.platform-icon.google-ai-overview { background: #ea4335; }
.platform-icon.grok { background: #000000; }
.platform-icon.deepseek { background: #5865f2; }
.platform-icon.all-models { background: #333333; }

/* Bar visualization */
.bar-cell {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
}

.bar-container {
    width: 60px;
    height: 8px;
    background: #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
}

.bar-fill {
    height: 100%;
    background: var(--color-primary);
    border-radius: 4px;
}

.bar-value {
    font-weight: 600;
    min-width: 45px;
    text-align: right;
}

/* Numeric formatting */
.metric-value {
    font-weight: 600;
    color: var(--color-text-primary);
}

/* Tables grid layout */
.tables-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-xl);
    margin-bottom: var(--spacing-2xl);
}
/* === sunburst-prompts.html === */
/* Sunburst template-specific overrides - base styles in components.html */
/* === kpi-cards-dual.html === */
.kpi-row-dual {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
}

/* Tooltip styles for dual/donut cards - uses global tooltip from components.html */
.kpi-card-dual .kpi-tooltip,
.kpi-card-donut .kpi-tooltip {
    position: absolute;
    top: 12px;
    right: 12px;
}
/* === prompt-rankings-table.html === */
/* Prompt Rankings Table Card */
.prompt-rankings-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    overflow: hidden;
}

.prompt-rankings-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-xl) var(--spacing-2xl);
    border-bottom: 1px solid var(--color-border);
}

.prompt-rankings-card .card-title {
    font-family: var(--font-display);
    font-size: 16px;
    font-weight: 700;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
}

.prompt-rankings-card .tooltip-icon {
    position: relative;
    width: 18px;
    height: 18px;
    background: var(--color-accent-purple);
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: help;
    flex-shrink: 0;
}

.prompt-rankings-card .tooltip-icon span {
    color: white;
    font-size: 12px;
    font-weight: 700;
    line-height: 1;
}

.prompt-rankings-card .tooltip-text {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    top: 28px;
    left: 0;
    width: 280px;
    background: #333;
    color: white;
    font-family: var(--font-body);
    font-size: 12px;
    font-weight: 400;
    padding: 10px 12px;
    border-radius: 6px;
    line-height: 1.4;
    z-index: 100;
    transition: opacity 0.2s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.prompt-rankings-card .tooltip-text::before {
    content: '';
    position: absolute;
    top: -6px;
    left: 12px;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid #333;
}

.prompt-rankings-card .tooltip-icon:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

.prompt-rankings-card .export-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-family: var(--font-body);
    font-size: 13px;
    color: var(--color-text-primary);
    cursor: pointer;
    transition: all 0.2s;
}

.prompt-rankings-card .export-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

/* Table */
.prompt-rankings-card .table-wrapper {
    overflow-x: auto;
    max-height: 600px;
    overflow-y: auto;
}

.prompt-rankings-card .table-wrapper thead {
    position: sticky;
    top: 0;
    z-index: 10;
}

.rankings-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.rankings-table th {
    background: #f9fafb;
    padding: 12px 16px;
    text-align: left;
    font-size: 11px;
    font-weight: 600;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--color-border);
    white-space: nowrap;
}

.rankings-table th.sortable {
    cursor: pointer;
    user-select: none;
}

.rankings-table th.sortable:hover {
    color: var(--color-primary);
}

.rankings-table th .sort-icon {
    margin-left: 4px;
    opacity: 0.4;
}

.rankings-table td {
    padding: 14px 16px;
    border-bottom: 1px solid var(--color-border);
    vertical-align: middle;
}

.rankings-table tbody tr:hover {
    background: #f9fafb;
}

/* Column group headers */
.rankings-table .col-group-header {
    text-align: center !important;
    background: #f3f4f6 !important;
    border-left: 2px solid var(--color-border);
}

.rankings-table .col-subheader {
    font-size: 10px !important;
    font-weight: 500 !important;
    text-transform: none !important;
    letter-spacing: 0 !important;
}

.rankings-table .border-left {
    border-left: 2px solid var(--color-border);
}

/* Prompt column */
.rankings-table .prompt-link {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500;
    display: block;
    max-width: 260px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.rankings-table .prompt-link:hover {
    text-decoration: underline;
}

/* Model icon */
.rankings-table .model-icon {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: white;
}

.rankings-table .model-icon.chatgpt { background: #10a37f; }
.rankings-table .model-icon.gemini { background: #4285f4; }
.rankings-table .model-icon.perplexity { background: #1a1a2e; }
.rankings-table .model-icon.ai-overview { background: #ea4335; }

/* Topic */
.rankings-table .topic-text {
    max-width: 160px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: var(--color-text-secondary);
}

/* Volume */
.rankings-table .volume-value {
    font-weight: 600;
    color: var(--color-text-primary);
}

/* Visibility bar */
.rankings-table .visibility-cell {
    min-width: 110px;
}

.rankings-table .visibility-bar {
    display: flex;
    align-items: center;
    gap: 10px;
}

.rankings-table .visibility-bar-bg {
    flex: 1;
    height: 8px;
    background: #e5e7eb;
    border-radius: 4px;
    overflow: hidden;
}

.rankings-table .visibility-bar-fill {
    height: 100%;
    background: var(--color-primary);
    border-radius: 4px;
    transition: width 0.3s;
}

.rankings-table .visibility-value {
    font-size: 12px;
    font-weight: 600;
    min-width: 38px;
    text-align: right;
}

/* Position values */
.rankings-table .position-value {
    font-weight: 600;
    text-align: center;
    display: block;
}

.rankings-table .position-value.top-3 { color: var(--color-positive); }
.rankings-table .position-value.mid { color: var(--color-warning); }
.rankings-table .position-value.low { color: var(--color-text-secondary); }

.rankings-table .position-na {
    color: var(--color-text-muted);
    text-align: center;
    display: block;
}

/* Position change */
.rankings-table .position-change {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.rankings-table .position-change.up {
    color: var(--color-positive);
    background: rgba(16, 185, 129, 0.1);
}

.rankings-table .position-change.down {
    color: var(--color-negative);
    background: rgba(239, 68, 68, 0.1);
}

.rankings-table .position-change.neutral {
    color: var(--color-text-muted);
    background: #f3f4f6;
}

.rankings-table .position-change.new {
    color: var(--color-primary);
    background: rgba(20, 40, 160, 0.1);
}

.rankings-table .position-change.lost {
    color: var(--color-negative);
    background: rgba(239, 68, 68, 0.1);
}

/* Product names */
.rankings-table .product-name {
    font-size: 12px;
    max-width: 140px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: block;
}

.rankings-table .product-samsung {
    color: var(--color-primary);
    font-weight: 600;
}

.rankings-table .product-competitor {
    color: var(--color-text-secondary);
}

.rankings-table .product-na {
    color: var(--color-text-muted);
}

/* === source-analysis.html === */
/* Source Type Colors */
:root {
    --color-source-owned: #1428A0;
    --color-source-earned: #10a37f;
    --color-source-social: #8e44ad;
    --color-source-competitor: #f9ab00;
    --color-source-other: #9e9e9e;
}

/* Source Section Header */
.source-section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
    padding-top: var(--spacing-2xl);
    border-top: 1px solid var(--color-border);
}

.source-section-title {
    font-family: var(--font-display);
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
}

.source-section-subtitle {
    font-size: var(--font-size-base);
    color: var(--color-text-secondary);
    margin-top: var(--spacing-xs);
}

/* Source KPI Cards (single-row style) */
.source-kpi-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
}

.source-kpi-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.source-kpi-card .kpi-left {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.source-kpi-card .kpi-label {
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 400;
    color: var(--color-text-secondary);
}

.source-kpi-card .kpi-right {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.source-kpi-card .kpi-value {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
    line-height: 1;
}

/* Source Type Pie Chart */
.source-chart-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-2xl);
}

.source-chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
}

.source-chart-title {
    font-family: var(--font-display);
    font-size: var(--font-size-md);
    font-weight: 700;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
}

.source-chart-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 60px;
}

.source-donut-wrapper {
    position: relative;
    width: 200px;
    height: 200px;
}

.source-donut-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    pointer-events: none;
}

.source-donut-total {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    line-height: 1;
}

.source-donut-label {
    font-size: 11px;
    color: var(--color-text-secondary);
    text-transform: uppercase;
}

.source-legend {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.source-legend-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    font-size: 14px;
    cursor: pointer;
    transition: opacity 0.2s;
}

.source-legend-item:hover {
    opacity: 0.7;
}

.source-legend-color {
    width: 16px;
    height: 16px;
    border-radius: 4px;
}

.source-legend-color.owned { background: var(--color-source-owned); }
.source-legend-color.earned { background: var(--color-source-earned); }
.source-legend-color.social { background: var(--color-source-social); }
.source-legend-color.competitor { background: var(--color-source-competitor); }
.source-legend-color.other { background: var(--color-source-other); }

.source-legend-label {
    flex: 1;
    color: var(--color-text-secondary);
}

.source-legend-value {
    font-family: var(--font-display);
    font-weight: 700;
    min-width: 50px;
    text-align: right;
}

.source-legend-percent {
    font-size: 12px;
    color: var(--color-text-secondary);
    min-width: 40px;
    text-align: right;
}

.source-arc {
    cursor: pointer;
    transition: opacity 0.2s ease, transform 0.2s ease;
}

.source-arc:hover {
    opacity: 0.8;
}

/* Source Tables Grid */
.source-tables-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-xl);
    margin-bottom: var(--spacing-2xl);
}

.source-table-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
}

.source-table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
}

.source-table-title {
    font-family: var(--font-display);
    font-size: 14px;
    font-weight: 700;
    color: #333;
    display: flex;
    align-items: center;
    gap: 6px;
}

.source-data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.source-data-table th {
    text-align: left;
    font-weight: 600;
    color: var(--color-text-secondary);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 8px 12px;
    border-bottom: 1px solid var(--color-border);
}

.source-data-table th:not(:first-child) {
    text-align: right;
}

.source-data-table td {
    padding: 10px 12px;
    border-bottom: 1px solid #f0f0f0;
    vertical-align: middle;
}

.source-data-table td:not(:first-child) {
    text-align: right;
}

.source-data-table tbody tr:last-child td {
    border-bottom: none;
}

.source-data-table tbody tr:nth-child(even) {
    background: #f8f9fa;
}

.source-data-table tbody tr:hover {
    background: #f0f1f3;
}

/* Source Type Badge */
.source-type-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.source-type-badge.owned {
    background: rgba(20, 40, 160, 0.1);
    color: var(--color-source-owned);
}

.source-type-badge.earned {
    background: rgba(16, 163, 127, 0.1);
    color: var(--color-source-earned);
}

.source-type-badge.social {
    background: rgba(142, 68, 173, 0.1);
    color: var(--color-source-social);
}

.source-type-badge.competitor {
    background: rgba(249, 171, 0, 0.1);
    color: #c98a00;
}

.source-type-badge.other {
    background: rgba(158, 158, 158, 0.1);
    color: var(--color-source-other);
}

.source-domain-name {
    font-weight: 500;
    color: var(--color-text-primary);
}

.source-url-name {
    font-size: 12px;
    color: var(--color-text-secondary);
    max-width: 250px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Source Bar visualization */
.source-bar-cell {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
}

.source-bar-container {
    width: 60px;
    height: 8px;
    background: #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
}

.source-bar-fill {
    height: 100%;
    background: var(--color-primary);
    border-radius: 4px;
}

.source-bar-value {
    font-weight: 600;
    min-width: 45px;
    text-align: right;
}

/* Source position change */
.source-position-change {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.source-position-change.up {
    color: #10b981;
    background: rgba(16, 185, 129, 0.1);
}

.source-position-change.down {
    color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
}

.source-position-change.neutral {
    color: var(--color-text-secondary);
    background: #f3f4f6;
}

.source-table-pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: var(--spacing-lg);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-border);
    font-size: 13px;
    color: var(--color-text-secondary);
}

.source-pagination-info {
    font-size: 12px;
}

/* Competitor Analysis Section */
.competitor-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-2xl);
}

.competitor-table .brand-cell {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.brand-indicator {
    width: 4px;
    height: 28px;
    border-radius: 2px;
}

.brand-indicator.samsung { background: var(--color-brand-samsung); }
.brand-indicator.lg { background: var(--color-brand-lg); }
.brand-indicator.sony { background: var(--color-brand-sony); }
.brand-indicator.tcl { background: var(--color-brand-tcl); }
.brand-indicator.hisense { background: var(--color-brand-hisense); }

.brand-info {
    display: flex;
    flex-direction: column;
}

.brand-name {
    font-weight: 600;
    color: var(--color-text-primary);
}

.brand-domain {
    font-size: 12px;
    color: var(--color-text-secondary);
}

.vs-delta {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-weight: 600;
}

.vs-delta.ahead {
    color: var(--color-accent-red);
}

.vs-delta.behind {
    color: var(--color-accent-green);
}

.vs-delta.same {
    color: var(--color-text-secondary);
}

.source-data-table tbody tr.brand-row {
    background: rgba(20, 40, 160, 0.03);
}

.source-data-table tbody tr.brand-row:hover {
    background: rgba(20, 40, 160, 0.06);
}

/* Source Analysis Responsive */
@media (max-width: 1024px) {
    .source-kpi-row {
        grid-template-columns: repeat(2, 1fr);
    }

    .source-tables-grid {
        grid-template-columns: 1fr;
    }

    .source-chart-container {
        flex-direction: column;
        gap: var(--spacing-xl);
    }
}

/* === prompt-analysis section === */
.prompt-section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
    padding-top: var(--spacing-2xl);
    border-top: 1px solid var(--color-border);
}

.prompt-section-title {
    font-family: var(--font-display);
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
}

.prompt-section-subtitle {
    font-size: var(--font-size-base);
    color: var(--color-text-secondary);
    margin-top: var(--spacing-xs);
}

/* Prompt KPI Cards (double-stacked compact style) */
.prompt-kpi-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
}

@media (max-width: 1200px) {
    .prompt-kpi-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .prompt-kpi-grid {
        grid-template-columns: 1fr;
    }
}

/* === Filter Bar === */
.filter-bar {
    background: var(--color-bg-card);
    border-bottom: 1px solid var(--color-border);
    padding: var(--spacing-md) 0;
    margin-bottom: var(--spacing-2xl);
    position: sticky;
    top: 0;
    z-index: 100;
}

.filter-bar-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 var(--spacing-xl);
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.filter-label {
    font-family: var(--font-body);
    font-size: 12px;
    font-weight: 500;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.filter-select {
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--color-text-primary);
    background: var(--color-bg-page);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: 8px 32px 8px 12px;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    min-width: 140px;
}

.filter-select:hover,
.filter-select:focus {
    border-color: var(--color-primary);
    outline: none;
}

.filter-select.has-filter {
    border-color: var(--color-primary);
    background-color: rgba(20, 40, 160, 0.05);
}

/* Date Range Picker */
.date-range-wrapper {
    position: relative;
}

.date-range-btn {
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--color-text-primary);
    background: var(--color-bg-page);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: 8px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    min-width: 180px;
}

.date-range-btn:hover {
    border-color: var(--color-primary);
}

.date-range-btn .calendar-icon {
    width: 16px;
    height: 16px;
    opacity: 0.6;
}

.date-range-btn .date-text {
    flex: 1;
}

.date-range-btn .dropdown-arrow {
    font-size: 10px;
    opacity: 0.6;
}

.date-range-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 4px;
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
    z-index: 1000;
    display: none;
    min-width: 280px;
}

.date-range-dropdown.active {
    display: block;
}

.date-presets {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.date-preset-btn {
    display: block;
    width: 100%;
    text-align: left;
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--color-text-primary);
    background: none;
    border: none;
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    cursor: pointer;
}

.date-preset-btn:hover {
    background: var(--color-bg-page);
}

.date-preset-btn.active {
    background: var(--color-primary);
    color: white;
}

.date-custom {
    padding: var(--spacing-md);
}

.date-custom-label {
    font-size: 12px;
    font-weight: 500;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-xs);
}

.date-inputs {
    display: flex;
    gap: var(--spacing-sm);
    align-items: center;
}

.date-input {
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--color-text-primary);
    background: var(--color-bg-page);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: 6px 10px;
    width: 120px;
}

.date-input:focus {
    outline: none;
    border-color: var(--color-primary);
}

.date-separator {
    color: var(--color-text-secondary);
    font-size: 12px;
}

.date-apply-btn {
    margin-top: var(--spacing-sm);
    width: 100%;
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 500;
    color: white;
    background: var(--color-primary);
    border: none;
    border-radius: var(--radius-md);
    padding: 8px 16px;
    cursor: pointer;
}

.date-apply-btn:hover {
    background: var(--color-primary-dark);
}

/* Filter Buttons */
.filter-divider {
    width: 1px;
    height: 24px;
    background: var(--color-border);
}

.reset-filters-btn {
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 500;
    color: var(--color-text-secondary);
    background: transparent;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: 8px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.reset-filters-btn:hover {
    color: var(--color-text-primary);
    border-color: var(--color-text-secondary);
    background: var(--color-bg-page);
}

.reset-filters-btn .reset-icon {
    width: 14px;
    height: 14px;
}

.advanced-filter-btn {
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 500;
    color: var(--color-primary);
    background: transparent;
    border: 1px solid var(--color-primary);
    border-radius: var(--radius-md);
    padding: 8px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-left: auto;
}

.advanced-filter-btn:hover {
    background: rgba(20, 40, 160, 0.05);
}

.advanced-filter-btn .filter-icon {
    width: 14px;
    height: 14px;
}


@media (max-width: 1024px) {
    .filter-bar-content {
        gap: var(--spacing-sm);
    }
    .filter-select {
        min-width: 120px;
        font-size: 13px;
    }
    .date-range-btn {
        min-width: 160px;
        font-size: 13px;
    }
    .filter-divider {
        display: none;
    }
}

@media (max-width: 768px) {
    .filter-bar-content {
        flex-direction: column;
        align-items: stretch;
    }
    .filter-group {
        width: 100%;
    }
    .filter-select,
    .date-range-btn {
        flex: 1;
        width: 100%;
    }
    .advanced-filter-btn {
        margin-left: 0;
        justify-content: center;
    }
}
    </style>
</head>
<body>
<!-- === header.html === -->
<header>
    <div class="header-content">
        <span class="header-title">Samsung HE AI Visibility and Performance Dashboard</span>
        <img class="header-logo" src="./images/logo.jpg" alt="Samsung">
    </div>
</header>

<!-- === filter-bar.html === -->
<div class="filter-bar">
    <div class="filter-bar-content">
        <!-- Date Range Selector -->
        <div class="filter-group">
            <div class="date-range-wrapper">
                <button class="date-range-btn" id="dateRangeBtn">
                    <svg class="calendar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <span class="date-text" id="dateRangeText">Last 30 Days</span>
                    <span class="dropdown-arrow">&#9662;</span>
                </button>
                <div class="date-range-dropdown" id="dateRangeDropdown">
                    <div class="date-presets">
                        <button class="date-preset-btn active" data-range="30">Last 30 Days</button>
                        <button class="date-preset-btn" data-range="7">Last 7 Days</button>
                        <button class="date-preset-btn" data-range="90">Last 90 Days</button>
                        <button class="date-preset-btn" data-range="365">Last 12 Months</button>
                        <button class="date-preset-btn" data-range="custom">Custom Range</button>
                    </div>
                    <div class="date-custom" id="dateCustom" style="display: none;">
                        <div class="date-custom-label">Select Date Range</div>
                        <div class="date-inputs">
                            <input type="date" class="date-input" id="dateStart">
                            <span class="date-separator">to</span>
                            <input type="date" class="date-input" id="dateEnd">
                        </div>
                        <button class="date-apply-btn" id="dateApplyBtn">Apply</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="filter-divider"></div>

        <!-- AI Platform Filter -->
        <div class="filter-group">
            <label class="filter-label" for="platformFilter">AI Platform</label>
            <select class="filter-select" id="platformFilter">
                <option value="all" selected>All Platforms</option>
                <option value="chatgpt">ChatGPT</option>
                <option value="gemini">Gemini</option>
                <option value="perplexity">Perplexity</option>
                <option value="claude">Claude</option>
                <option value="copilot">Copilot</option>
            </select>
        </div>

        <!-- TV Category Filter -->
        <div class="filter-group">
            <label class="filter-label" for="categoryFilter">Category</label>
            <select class="filter-select" id="categoryFilter">
                <option value="all" selected>All Categories</option>
                <option value="tv-features">TV Features</option>
                <option value="tv-models">TV Models</option>
                <option value="tv-reviews">Reviews & Brand</option>
            </select>
        </div>

        <!-- TV Model Type Filter -->
        <div class="filter-group">
            <label class="filter-label" for="modelFilter">Model Type</label>
            <select class="filter-select" id="modelFilter">
                <option value="all" selected>All Models</option>
                <option value="neo-qled">Neo QLED</option>
                <option value="qled">QLED</option>
                <option value="oled">OLED</option>
                <option value="mini-led">Mini-LED</option>
                <option value="micro-led">Micro LED</option>
                <option value="crystal-uhd">Crystal UHD</option>
                <option value="the-frame">The Frame</option>
                <option value="gaming">Gaming TVs</option>
                <option value="outdoor">Outdoor TV</option>
            </select>
        </div>

        <div class="filter-divider"></div>

        <!-- Reset Filters Button -->
        <button class="reset-filters-btn" id="resetFiltersBtn">
            <svg class="reset-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </svg>
            Reset
        </button>

        <!-- Advanced Filter Button -->
        <button class="advanced-filter-btn" id="advancedFilterBtn">
            <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
            </svg>
            Advanced Filters
        </button>
    </div>
</div>

<!-- === kpi-cards.html === -->
<div class="container">
    <div class="kpi-row">
        <div class="kpi-card">
            <div class="kpi-tooltip">
                <span>?</span>
                <div class="kpi-tooltip-text">Estimated share of audience likely to notice your brand in AI search results, based on prompt popularity and ranking position.</div>
            </div>
            <img class="kpi-icon" src="./images/sov.jpg" alt="Share of Voice">
            <div class="kpi-label">Share of Voice</div>
            <div class="kpi-value" id="kpi-sov">--</div>
            <span class="change-badge neutral" id="kpi-sov-change">Loading...</span>
        </div>
        <div class="kpi-card">
            <div class="kpi-tooltip">
                <span>?</span>
                <div class="kpi-tooltip-text">Percentage of AI responses that cite your website as a source.</div>
            </div>
            <img class="kpi-icon" src="./images/source_visi.jpg" alt="Source Visibility">
            <div class="kpi-label">Source Visibility</div>
            <div class="kpi-value" id="kpi-source">--</div>
            <span class="change-badge neutral" id="kpi-source-change">Loading...</span>
        </div>
        <div class="kpi-card">
            <div class="kpi-tooltip">
                <span>?</span>
                <div class="kpi-tooltip-text">Total visits to your website from AI platforms.</div>
            </div>
            <img class="kpi-icon" src="./images/referral.jpg" alt="Referral Traffic">
            <div class="kpi-label">Referral Traffic</div>
            <div class="kpi-value" id="kpi-traffic">--</div>
            <span class="change-badge neutral" id="kpi-traffic-change">Loading...</span>
        </div>
        <div class="kpi-card">
            <div class="kpi-tooltip">
                <span>?</span>
                <div class="kpi-tooltip-text">Overall visibility score measuring your brand's presence across AI platforms.</div>
            </div>
            <img class="kpi-icon" src="./images/ai-visi.jpg" alt="AI Visibility">
            <div class="kpi-label">AI Visibility</div>
            <div class="kpi-value" id="kpi-visibility">--</div>
            <span class="change-badge neutral" id="kpi-visibility-change">Loading...</span>
        </div>
    </div>
</div>
<!-- === line-charts.html === -->
<div class="container">
    <!-- ROW 1: Share of Voice + Source Visibility -->
    <div class="charts-row">
        <!-- CHART 1: Share of Voice -->
        <div class="chart-card">
            <div class="chart-header">
                <div class="chart-title">
                    Share of Voice
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Estimated share of audience likely to notice your brand in AI search results, based on prompt popularity and ranking position.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
            </div>
            <div class="chart-content">
                <div class="chart-area">
                    <svg id="chart-sov"></svg>
                </div>
                <div class="chart-insights">
                    <div class="insight-item">
                        <div class="insight-label">Leader</div>
                        <div class="insight-value">Samsung</div>
                        <div class="insight-change">65% share</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-label">Trend</div>
                        <div class="insight-value positive">â†‘ +3%</div>
                        <div class="insight-change">vs last period</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-label">Gap to #2</div>
                        <div class="insight-value">37pts</div>
                        <div class="insight-change">ahead of LG</div>
                    </div>
                </div>
            </div>
            <div class="chart-legend">
                <div class="legend-item"><span class="legend-dot" style="background: #1428A0"></span>Samsung</div>
                <div class="legend-item"><span class="legend-dot" style="background: #A50034"></span>LG</div>
                <div class="legend-item"><span class="legend-dot" style="background: #000000"></span>Sony</div>
                <div class="legend-item"><span class="legend-dot" style="background: #E31937"></span>TCL</div>
                <div class="legend-item"><span class="legend-dot" style="background: #00A0DF"></span>Hisense</div>
            </div>
        </div>

        <!-- CHART 2: Source Visibility -->
        <div class="chart-card">
            <div class="chart-header">
                <div class="chart-title">
                    Source Visibility
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Percentage of AI responses that cite your website as a source.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
            </div>
            <div class="chart-content">
                <div class="chart-area">
                    <svg id="chart-source"></svg>
                </div>
                <div class="chart-insights">
                    <div class="insight-item">
                        <div class="insight-label">Top Source</div>
                        <div class="insight-value">Samsung</div>
                        <div class="insight-change">42% cited</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-label">Growth</div>
                        <div class="insight-value positive">â†‘ +4%</div>
                        <div class="insight-change">this month</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-label">Citations</div>
                        <div class="insight-value">1,847</div>
                        <div class="insight-change">total mentions</div>
                    </div>
                </div>
            </div>
            <div class="chart-legend">
                <div class="legend-item"><span class="legend-dot" style="background: #1428A0"></span>Samsung</div>
                <div class="legend-item"><span class="legend-dot" style="background: #A50034"></span>LG</div>
                <div class="legend-item"><span class="legend-dot" style="background: #000000"></span>Sony</div>
                <div class="legend-item"><span class="legend-dot" style="background: #E31937"></span>TCL</div>
                <div class="legend-item"><span class="legend-dot" style="background: #00A0DF"></span>Hisense</div>
            </div>
        </div>
    </div>

    <!-- ROW 2: Referral Traffic + AI Visibility -->
    <div class="charts-row">
        <!-- CHART 3: Referral Traffic -->
        <div class="chart-card">
            <div class="chart-header">
                <div class="chart-title">
                    Referral Traffic
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Total visits to your website from AI platforms.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
            </div>
            <div class="chart-content">
                <div class="chart-area">
                    <svg id="chart-traffic"></svg>
                </div>
                <div class="chart-insights">
                    <div class="insight-item">
                        <div class="insight-label">Total Visits</div>
                        <div class="insight-value">106,445</div>
                        <div class="insight-change">from AI platforms</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-label">Change</div>
                        <div class="insight-value positive">â†‘ +10,989</div>
                        <div class="insight-change">+10.3% growth</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-label">Top Platform</div>
                        <div class="insight-value">ChatGPT</div>
                        <div class="insight-change">65,054 visits</div>
                    </div>
                </div>
            </div>
            <div class="chart-legend">
                <div class="legend-item"><span class="legend-dot" style="background: #1428A0"></span>Samsung</div>
                <div class="legend-item"><span class="legend-dot" style="background: #A50034"></span>LG</div>
                <div class="legend-item"><span class="legend-dot" style="background: #000000"></span>Sony</div>
                <div class="legend-item"><span class="legend-dot" style="background: #E31937"></span>TCL</div>
                <div class="legend-item"><span class="legend-dot" style="background: #00A0DF"></span>Hisense</div>
            </div>
        </div>

        <!-- CHART 4: AI Visibility -->
        <div class="chart-card">
            <div class="chart-header">
                <div class="chart-title">
                    AI Visibility
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Overall visibility score measuring your brand's presence across AI platforms.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
            </div>
            <div class="chart-content">
                <div class="chart-area">
                    <svg id="chart-visibility"></svg>
                </div>
                <div class="chart-insights">
                    <div class="insight-item">
                        <div class="insight-label">Score</div>
                        <div class="insight-value">91</div>
                        <div class="insight-change">out of 100</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-label">Rank</div>
                        <div class="insight-value">#1</div>
                        <div class="insight-change">in TV category</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-label">Momentum</div>
                        <div class="insight-value positive">â†‘ +6</div>
                        <div class="insight-change">points gained</div>
                    </div>
                </div>
            </div>
            <div class="chart-legend">
                <div class="legend-item"><span class="legend-dot" style="background: #1428A0"></span>Samsung</div>
                <div class="legend-item"><span class="legend-dot" style="background: #A50034"></span>LG</div>
                <div class="legend-item"><span class="legend-dot" style="background: #000000"></span>Sony</div>
                <div class="legend-item"><span class="legend-dot" style="background: #E31937"></span>TCL</div>
                <div class="legend-item"><span class="legend-dot" style="background: #00A0DF"></span>Hisense</div>
            </div>
        </div>
    </div>

    <!-- Tooltip element for line charts -->
    <div class="line-chart-tooltip" id="line-chart-tooltip"></div>
</div>
<!-- === platform-tables.html === -->
<div class="container">
    <div class="tables-grid">
        <!-- TABLE 1: Prompt Tracking Rankings (Share of Voice) -->
        <div class="platform-table-card">
            <div class="table-header">
                <div class="table-title">
                    Prompt Tracking Rankings
                    <div class="table-tooltip-icon">
                        <span>?</span>
                        <div class="table-tooltip-text">Share of Voice breakdown by AI platform, showing mentions and average ranking position.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
            </div>
            <table class="platform-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Share of Voice</th>
                        <th>Mentions</th>
                        <th>Avg. Position</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon google-ai-mode">G</div>
                                Google AI Mode
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 72%"></div></div>
                                <span class="bar-value">72%</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 82%"></div></div>
                                <span class="bar-value">53</span>
                            </div>
                        </td>
                        <td class="metric-value">1.7</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon google-ai-overview">G</div>
                                Google AI Overview
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 61%"></div></div>
                                <span class="bar-value">61%</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 66%"></div></div>
                                <span class="bar-value">43</span>
                            </div>
                        </td>
                        <td class="metric-value">2.1</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon chatgpt">C</div>
                                ChatGPT
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 60%"></div></div>
                                <span class="bar-value">60%</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 100%"></div></div>
                                <span class="bar-value">65</span>
                            </div>
                        </td>
                        <td class="metric-value">2.3</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- TABLE 2: Prompt Tracking Citations (Source Visibility) -->
        <div class="platform-table-card">
            <div class="table-header">
                <div class="table-title">
                    Prompt Tracking Citations
                    <div class="table-tooltip-icon">
                        <span>?</span>
                        <div class="table-tooltip-text">Source Visibility breakdown by AI platform, showing citation counts and unique URLs cited.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
            </div>
            <table class="platform-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Source Visibility</th>
                        <th>Citations</th>
                        <th>Cited URLs</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon google-ai-overview">G</div>
                                Google AI Overview
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 52%"></div></div>
                                <span class="bar-value">52%</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 100%"></div></div>
                                <span class="bar-value">2,555</span>
                            </div>
                        </td>
                        <td class="metric-value">129</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon chatgpt">C</div>
                                ChatGPT
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 34%"></div></div>
                                <span class="bar-value">34%</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 50%"></div></div>
                                <span class="bar-value">1,287</span>
                            </div>
                        </td>
                        <td class="metric-value">288</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon google-ai-mode">G</div>
                                Google AI Mode
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 45%"></div></div>
                                <span class="bar-value">45%</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 52%"></div></div>
                                <span class="bar-value">1,332</span>
                            </div>
                        </td>
                        <td class="metric-value">427</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- TABLE 3: Referral Traffic by Platform -->
        <div class="platform-table-card">
            <div class="table-header">
                <div class="table-title">
                    Referral Traffic
                    <div class="table-tooltip-icon">
                        <span>?</span>
                        <div class="table-tooltip-text">Website visits from each AI platform, ranked by total traffic volume.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
            </div>
            <table class="platform-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Total Visits</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon chatgpt">C</div>
                                ChatGPT
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 100%"></div></div>
                                <span class="bar-value metric-value">65,054</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon perplexity">P</div>
                                Perplexity
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 19%"></div></div>
                                <span class="bar-value metric-value">12,614</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon gemini">G</div>
                                Gemini
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 19%"></div></div>
                                <span class="bar-value metric-value">12,492</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon copilot">C</div>
                                Copilot
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 9%"></div></div>
                                <span class="bar-value metric-value">6,149</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon google-ai-mode">G</div>
                                Google AI Mode
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 7%"></div></div>
                                <span class="bar-value metric-value">4,739</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon grok">X</div>
                                Grok
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 6%"></div></div>
                                <span class="bar-value metric-value">3,894</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon deepseek">D</div>
                                Deepseek
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 0.2%"></div></div>
                                <span class="bar-value metric-value">143</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- TABLE 4: AI Visibility by Platform -->
        <div class="platform-table-card">
            <div class="table-header">
                <div class="table-title">
                    AI Visibility
                    <div class="table-tooltip-icon">
                        <span>?</span>
                        <div class="table-tooltip-text">Brand visibility metrics by AI platform, including mentions, audience reach, and pages cited.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
            </div>
            <table class="platform-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Mentions</th>
                        <th>Audience</th>
                        <th>Cited Pages</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon all-models">*</div>
                                All Models
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 100%"></div></div>
                                <span class="bar-value">336,070</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 100%"></div></div>
                                <span class="bar-value">1.02B</span>
                            </div>
                        </td>
                        <td class="metric-value">86,918</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon google-ai-overview">G</div>
                                AI Overview
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 38%"></div></div>
                                <span class="bar-value">127,293</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 86%"></div></div>
                                <span class="bar-value">880.6M</span>
                            </div>
                        </td>
                        <td class="metric-value">58,296</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon chatgpt">C</div>
                                ChatGPT
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 24%"></div></div>
                                <span class="bar-value">79,785</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 7%"></div></div>
                                <span class="bar-value">73.0M</span>
                            </div>
                        </td>
                        <td class="metric-value">33,383</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon gemini">G</div>
                                Gemini
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 22%"></div></div>
                                <span class="bar-value">74,689</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 2%"></div></div>
                                <span class="bar-value">16.1M</span>
                            </div>
                        </td>
                        <td class="metric-value">6,693</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="platform-name">
                                <div class="platform-icon google-ai-mode">G</div>
                                AI Mode
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 18%"></div></div>
                                <span class="bar-value">60,879</span>
                            </div>
                        </td>
                        <td>
                            <div class="bar-cell">
                                <div class="bar-container"><div class="bar-fill" style="width: 5%"></div></div>
                                <span class="bar-value">54.1M</span>
                            </div>
                        </td>
                        <td class="metric-value">24,638</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- === prompt-analysis section header === -->
<div class="container">
    <div class="prompt-section-header">
        <div>
            <h2 class="prompt-section-title">Prompt Analysis</h2>
            <p class="prompt-section-subtitle">Track prompt performance, citations, mentions, and product visibility</p>
        </div>
    </div>
</div>

<!-- === prompt-kpi-cards.html (double-stacked compact) === -->
<div class="container">
    <div class="prompt-kpi-grid">
        <!-- Card 1: Prompts with Citations -->
        <div class="kpi-card-compact">
            <div class="kpi-section">
                <div class="kpi-section-left">
                    <span class="kpi-section-label">Prompts with Citations</span>
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Number of prompts where your domain is cited as a source.</div>
                    </div>
                </div>
                <div class="kpi-section-right">
                    <span class="kpi-value">312</span>
                    <span class="change-badge increase-good"><span class="arrow">&#8599;</span> +24</span>
                </div>
            </div>
            <div class="kpi-section">
                <div class="kpi-section-left">
                    <span class="kpi-section-label">Without Citations</span>
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Prompts without any citation to your domain.</div>
                    </div>
                </div>
                <div class="kpi-section-right">
                    <span class="kpi-value">70</span>
                    <span class="change-badge decrease"><span class="arrow">&#8600;</span> -8</span>
                </div>
            </div>
        </div>

        <!-- Card 2: Prompts with Mentions -->
        <div class="kpi-card-compact">
            <div class="kpi-section">
                <div class="kpi-section-left">
                    <span class="kpi-section-label">Prompts with Mentions</span>
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Prompts where your brand is mentioned in AI responses.</div>
                    </div>
                </div>
                <div class="kpi-section-right">
                    <span class="kpi-value">847</span>
                    <span class="change-badge decrease-bad"><span class="arrow">&#8600;</span> -18</span>
                </div>
            </div>
            <div class="kpi-section">
                <div class="kpi-section-left">
                    <span class="kpi-section-label">Without Mentions</span>
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Prompts without any brand mention in responses.</div>
                    </div>
                </div>
                <div class="kpi-section-right">
                    <span class="kpi-value">153</span>
                    <span class="change-badge increase"><span class="arrow">&#8599;</span> +12</span>
                </div>
            </div>
        </div>

        <!-- Card 3: Prompts with Products -->
        <div class="kpi-card-compact">
            <div class="kpi-section">
                <div class="kpi-section-left">
                    <span class="kpi-section-label">Prompts with Products</span>
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Prompts featuring your products in AI responses.</div>
                    </div>
                </div>
                <div class="kpi-section-right">
                    <span class="kpi-value">594</span>
                    <span class="change-badge increase-good"><span class="arrow">&#8599;</span> +37</span>
                </div>
            </div>
            <div class="kpi-section">
                <div class="kpi-section-left">
                    <span class="kpi-section-label">Without Products</span>
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Prompts without product visibility.</div>
                    </div>
                </div>
                <div class="kpi-section-right">
                    <span class="kpi-value">406</span>
                    <span class="change-badge decrease-bad"><span class="arrow">&#8600;</span> -15</span>
                </div>
            </div>
        </div>

        <!-- Card 4: Branded vs Non-branded Prompts -->
        <div class="kpi-card-compact">
            <div class="kpi-section">
                <div class="kpi-section-left">
                    <span class="kpi-section-label">Branded Prompts</span>
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Prompts that explicitly include your brand name in the query.</div>
                    </div>
                </div>
                <div class="kpi-section-right">
                    <span class="kpi-value">234</span>
                    <span class="change-badge increase-good"><span class="arrow">&#8599;</span> +19</span>
                </div>
            </div>
            <div class="kpi-section">
                <div class="kpi-section-left">
                    <span class="kpi-section-label">Non-branded Prompts</span>
                    <div class="tooltip-icon">
                        <span>?</span>
                        <div class="tooltip-text">Generic prompts without brand name that still return your products.</div>
                    </div>
                </div>
                <div class="kpi-section-right">
                    <span class="kpi-value">766</span>
                    <span class="change-badge increase-good"><span class="arrow">&#8599;</span> +42</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- === sunburst-prompts.html === -->
<div class="container">
    <div class="sunburst-card">
    <div class="card-header">
        <div class="card-title">
            Prompt Categories
            <div class="tooltip-icon">
                <span>?</span>
                <div class="tooltip-text">Interactive visualization of prompt categories. Click on segments to drill down into subcategories and view related prompts.</div>
            </div>
        </div>
    </div>

    <div class="sunburst-container">
        <div class="sunburst-chart">
            <div id="sunburst"></div>
            <div class="legend" id="legend"></div>
        </div>
        <div class="sunburst-metrics">
            <div class="metrics-header">Category Performance</div>
            <table class="metrics-table">
                <thead>
                    <tr>
                        <th>Tag</th>
                        <th>Mentions</th>
                        <th>Prompts</th>
                        <th>Share of Voice</th>
                        <th>Visibility</th>
                    </tr>
                </thead>
                <tbody id="metrics-tbody">
                    <!-- Populated by JS -->
                </tbody>
            </table>
        </div>
    </div>
    </div>
</div>
<!-- === prompt-rankings-table.html === -->
<div class="container">
    <div class="prompt-rankings-card">
    <div class="card-header">
        <div class="card-title">
            Prompt Rankings (Top Products)
            <div class="tooltip-icon">
                <span>?</span>
                <div class="tooltip-text">Shows prompt performance over time including visibility, position rankings, and top products mentioned. Samsung products are highlighted in blue.</div>
            </div>
        </div>
        <button class="export-btn">
            <span>â†“</span> Export
        </button>
    </div>

    <div class="table-wrapper">
        <table class="rankings-table">
            <thead>
                <tr>
                    <th class="sortable">Prompt <span class="sort-icon">â†•</span></th>
                    <th>Model</th>
                    <th class="sortable">Topic <span class="sort-icon">â†•</span></th>
                    <th class="sortable">Topic Vol. <span class="sort-icon">â†•</span></th>
                    <th class="sortable">Visibility <span class="sort-icon">â†•</span></th>
                    <th class="col-group-header" colspan="2">Position</th>
                    <th>Change</th>
                    <th class="col-group-header" colspan="2">Product</th>
                </tr>
                <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th class="col-subheader border-left">Dec 10, 2023</th>
                    <th class="col-subheader">Jan 8, 2025</th>
                    <th></th>
                    <th class="col-subheader border-left">Dec 10, 2023</th>
                    <th class="col-subheader">Jan 8, 2025</th>
                </tr>
            </thead>
            <tbody id="rankings-body">
                <!-- Populated by JavaScript -->
            </tbody>
        </table>
    </div>
    </div>
</div>

<!-- === source-analysis.html === -->
<div class="container">
    <!-- Section Header -->
    <div class="source-section-header">
        <div>
            <h2 class="source-section-title">Source Analysis</h2>
            <p class="source-section-subtitle">Track citations, domains, and competitive source visibility</p>
        </div>
    </div>

    <!-- Source KPI Cards (Single-row style) -->
    <div class="source-kpi-row">
        <!-- Citations KPI -->
        <div class="source-kpi-card">
            <div class="kpi-left">
                <span class="kpi-label">Citations</span>
                <div class="tooltip-icon">
                    <span>?</span>
                    <div class="tooltip-text">Total number of times your domain or content is cited as a source in AI-generated responses across all tracked prompts.</div>
                </div>
            </div>
            <div class="kpi-right">
                <div class="kpi-value">1,247</div>
                <span class="change-badge increase-good"><span class="arrow">&#8599;</span> +156</span>
            </div>
        </div>

        <!-- Citation Gaps KPI -->
        <div class="source-kpi-card">
            <div class="kpi-left">
                <span class="kpi-label">Citation Gaps</span>
                <div class="tooltip-icon">
                    <span>?</span>
                    <div class="tooltip-text">Number of prompts where competitors are cited but your brand is not. These represent opportunities to improve source coverage.</div>
                </div>
            </div>
            <div class="kpi-right">
                <div class="kpi-value">83</div>
                <span class="change-badge decrease"><span class="arrow">&#8600;</span> -12</span>
            </div>
        </div>

        <!-- Mentions KPI -->
        <div class="source-kpi-card">
            <div class="kpi-left">
                <span class="kpi-label">Mentions</span>
                <div class="tooltip-icon">
                    <span>?</span>
                    <div class="tooltip-text">Total brand mentions across AI responses, including inline references and citations from any source mentioning your brand.</div>
                </div>
            </div>
            <div class="kpi-right">
                <div class="kpi-value">3,892</div>
                <span class="change-badge increase-good"><span class="arrow">&#8599;</span> +284</span>
            </div>
        </div>

        <!-- Source Visibility KPI -->
        <div class="source-kpi-card">
            <div class="kpi-left">
                <span class="kpi-label">Source Visibility</span>
                <div class="tooltip-icon">
                    <span>?</span>
                    <div class="tooltip-text">Percentage of AI responses that cite your website as a source across all tracked prompts.</div>
                </div>
            </div>
            <div class="kpi-right">
                <div class="kpi-value">42%</div>
                <span class="change-badge increase-good"><span class="arrow">&#8599;</span> +8%</span>
            </div>
        </div>
    </div>

    <!-- Source Type Pie Chart -->
    <div class="source-chart-card">
        <div class="source-chart-header">
            <div class="source-chart-title">
                AI Sources by Type
                <div class="tooltip-icon tooltip-center">
                    <span>?</span>
                    <div class="tooltip-text">Distribution of citation sources across owned properties, earned media, social platforms, competitors, and other sources.</div>
                </div>
            </div>
            <button class="download-btn" title="Download chart">
                <span>â†“</span>
            </button>
        </div>
        <div class="source-chart-container">
            <div class="source-donut-wrapper">
                <svg id="source-donut" width="200" height="200"></svg>
                <div class="source-donut-center">
                    <div class="source-donut-total">1,247</div>
                    <div class="source-donut-label">Citations</div>
                </div>
            </div>
            <div class="source-legend">
                <div class="source-legend-item" data-type="owned">
                    <div class="source-legend-color owned"></div>
                    <span class="source-legend-label">Owned</span>
                    <span class="source-legend-value">423</span>
                    <span class="source-legend-percent">33.9%</span>
                </div>
                <div class="source-legend-item" data-type="earned">
                    <div class="source-legend-color earned"></div>
                    <span class="source-legend-label">Earned</span>
                    <span class="source-legend-value">512</span>
                    <span class="source-legend-percent">41.1%</span>
                </div>
                <div class="source-legend-item" data-type="social">
                    <div class="source-legend-color social"></div>
                    <span class="source-legend-label">Social</span>
                    <span class="source-legend-value">156</span>
                    <span class="source-legend-percent">12.5%</span>
                </div>
                <div class="source-legend-item" data-type="competitor">
                    <div class="source-legend-color competitor"></div>
                    <span class="source-legend-label">Benchmark Competitors</span>
                    <span class="source-legend-value">98</span>
                    <span class="source-legend-percent">7.9%</span>
                </div>
                <div class="source-legend-item" data-type="other">
                    <div class="source-legend-color other"></div>
                    <span class="source-legend-label">Other</span>
                    <span class="source-legend-value">58</span>
                    <span class="source-legend-percent">4.6%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Source Domain & URL Tables -->
    <div class="source-tables-grid">
        <!-- Domain Table -->
        <div class="source-table-card">
            <div class="source-table-header">
                <div class="source-table-title">
                    Source Domains
                    <div class="tooltip-icon tooltip-center">
                        <span>?</span>
                        <div class="tooltip-text">Top domains cited as sources in AI responses for your tracked prompts.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download data">
                    <span>â†“</span>
                </button>
            </div>
            <table class="source-data-table">
                <thead>
                    <tr>
                        <th>Source Domain</th>
                        <th>Type</th>
                        <th>Citations</th>
                        <th>Change</th>
                        <th>Avg. Position</th>
                        <th>Source Visibility</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="source-domain-name">samsung.com</span></td>
                        <td><span class="source-type-badge owned">Owned</span></td>
                        <td>423</td>
                        <td><span class="source-position-change up">&#9650; 54</span></td>
                        <td>1.8</td>
                        <td>
                            <div class="source-bar-cell">
                                <div class="source-bar-container"><div class="source-bar-fill" style="width: 72%"></div></div>
                                <span class="source-bar-value">72%</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="source-domain-name">rtings.com</span></td>
                        <td><span class="source-type-badge earned">Earned</span></td>
                        <td>287</td>
                        <td><span class="source-position-change up">&#9650; 23</span></td>
                        <td>2.1</td>
                        <td>
                            <div class="source-bar-cell">
                                <div class="source-bar-container"><div class="source-bar-fill" style="width: 48%"></div></div>
                                <span class="source-bar-value">48%</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="source-domain-name">cnet.com</span></td>
                        <td><span class="source-type-badge earned">Earned</span></td>
                        <td>156</td>
                        <td><span class="source-position-change down">&#9660; 8</span></td>
                        <td>2.4</td>
                        <td>
                            <div class="source-bar-cell">
                                <div class="source-bar-container"><div class="source-bar-fill" style="width: 35%"></div></div>
                                <span class="source-bar-value">35%</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="source-domain-name">reddit.com</span></td>
                        <td><span class="source-type-badge social">Social</span></td>
                        <td>134</td>
                        <td><span class="source-position-change up">&#9650; 41</span></td>
                        <td>3.2</td>
                        <td>
                            <div class="source-bar-cell">
                                <div class="source-bar-container"><div class="source-bar-fill" style="width: 28%"></div></div>
                                <span class="source-bar-value">28%</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="source-domain-name">lg.com</span></td>
                        <td><span class="source-type-badge competitor">Competitor</span></td>
                        <td>98</td>
                        <td><span class="source-position-change neutral">&#8212; 0</span></td>
                        <td>2.6</td>
                        <td>
                            <div class="source-bar-cell">
                                <div class="source-bar-container"><div class="source-bar-fill" style="width: 22%"></div></div>
                                <span class="source-bar-value">22%</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="source-table-pagination">
                <span class="source-pagination-info">Showing 1-5 of 127 domains</span>
            </div>
        </div>

        <!-- URL Table -->
        <div class="source-table-card">
            <div class="source-table-header">
                <div class="source-table-title">
                    Cited URLs
                    <div class="tooltip-icon tooltip-center">
                        <span>?</span>
                        <div class="tooltip-text">Specific URLs most frequently cited in AI-generated responses.</div>
                    </div>
                </div>
                <button class="download-btn" title="Download data">
                    <span>â†“</span>
                </button>
            </div>
            <table class="source-data-table">
                <thead>
                    <tr>
                        <th>URL</th>
                        <th>Citations</th>
                        <th>Change</th>
                        <th>Position</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="source-url-name" title="samsung.com/tv/qled-tv/">samsung.com/tv/qled-tv/</span></td>
                        <td>87</td>
                        <td><span class="source-position-change up">&#9650; 12</span></td>
                        <td>1.4</td>
                    </tr>
                    <tr>
                        <td><span class="source-url-name" title="rtings.com/tv/reviews/samsung/s95d-oled">rtings.com/tv/reviews/samsung/s95d-oled</span></td>
                        <td>64</td>
                        <td><span class="source-position-change up">&#9650; 8</span></td>
                        <td>1.8</td>
                    </tr>
                    <tr>
                        <td><span class="source-url-name" title="samsung.com/tv/neo-qled/">samsung.com/tv/neo-qled/</span></td>
                        <td>52</td>
                        <td><span class="source-position-change down">&#9660; 3</span></td>
                        <td>2.1</td>
                    </tr>
                    <tr>
                        <td><span class="source-url-name" title="cnet.com/reviews/samsung-frame-tv-2024/">cnet.com/reviews/samsung-frame-tv-2024/</span></td>
                        <td>41</td>
                        <td><span class="source-position-change up">&#9650; 15</span></td>
                        <td>2.3</td>
                    </tr>
                    <tr>
                        <td><span class="source-url-name" title="reddit.com/r/4kTV/samsung_vs_lg_2024">reddit.com/r/4kTV/samsung_vs_lg_2024</span></td>
                        <td>38</td>
                        <td><span class="source-position-change up">&#9650; 22</span></td>
                        <td>3.1</td>
                    </tr>
                </tbody>
            </table>
            <div class="source-table-pagination">
                <span class="source-pagination-info">Showing 1-5 of 342 URLs</span>
            </div>
        </div>
    </div>

    <!-- Competitor Citation Analysis -->
    <div class="source-section-header" style="border-top: none; padding-top: 0;">
        <div>
            <h3 class="source-section-title" style="font-size: 18px;">Competitor Citation Analysis</h3>
            <p class="source-section-subtitle">Compare source citation performance against tracked competitors</p>
        </div>
    </div>
    <div class="competitor-card">
        <table class="source-data-table competitor-table">
            <thead>
                <tr>
                    <th>Competitor</th>
                    <th>Citations</th>
                    <th>Change</th>
                    <th>Avg. Position</th>
                    <th>vs Samsung</th>
                </tr>
            </thead>
            <tbody>
                <tr class="brand-row">
                    <td>
                        <div class="brand-cell">
                            <div class="brand-indicator samsung"></div>
                            <div class="brand-info">
                                <span class="brand-name">Samsung</span>
                                <span class="brand-domain">samsung.com</span>
                            </div>
                        </div>
                    </td>
                    <td>423</td>
                    <td><span class="source-position-change up">&#9650; 54</span></td>
                    <td>1.8</td>
                    <td><span class="vs-delta same">&#8212;</span></td>
                </tr>
                <tr>
                    <td>
                        <div class="brand-cell">
                            <div class="brand-indicator lg"></div>
                            <div class="brand-info">
                                <span class="brand-name">LG</span>
                                <span class="brand-domain">lg.com</span>
                            </div>
                        </div>
                    </td>
                    <td>387</td>
                    <td><span class="source-position-change up">&#9650; 28</span></td>
                    <td>2.1</td>
                    <td><span class="vs-delta behind">-36 behind</span></td>
                </tr>
                <tr>
                    <td>
                        <div class="brand-cell">
                            <div class="brand-indicator sony"></div>
                            <div class="brand-info">
                                <span class="brand-name">Sony</span>
                                <span class="brand-domain">sony.com</span>
                            </div>
                        </div>
                    </td>
                    <td>312</td>
                    <td><span class="source-position-change down">&#9660; 15</span></td>
                    <td>2.4</td>
                    <td><span class="vs-delta behind">-111 behind</span></td>
                </tr>
                <tr>
                    <td>
                        <div class="brand-cell">
                            <div class="brand-indicator tcl"></div>
                            <div class="brand-info">
                                <span class="brand-name">TCL</span>
                                <span class="brand-domain">tcl.com</span>
                            </div>
                        </div>
                    </td>
                    <td>198</td>
                    <td><span class="source-position-change up">&#9650; 42</span></td>
                    <td>3.2</td>
                    <td><span class="vs-delta behind">-225 behind</span></td>
                </tr>
                <tr>
                    <td>
                        <div class="brand-cell">
                            <div class="brand-indicator hisense"></div>
                            <div class="brand-info">
                                <span class="brand-name">Hisense</span>
                                <span class="brand-domain">hisense.com</span>
                            </div>
                        </div>
                    </td>
                    <td>156</td>
                    <td><span class="source-position-change up">&#9650; 67</span></td>
                    <td>3.5</td>
                    <td><span class="vs-delta behind">-267 behind</span></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
// === line-charts.html ===
// Chart configuration
const chartConfig = {
    width: 540,
    height: 300,
    margin: { top: 20, right: 20, bottom: 40, left: 55 }
};

// Color palette - brand colors
const colors = {
    samsung: '#1428A0',
    lg: '#A50034',
    sony: '#000000',
    tcl: '#E31937',
    hisense: '#00A0DF',
    grid: '#e8e8e8',
    axis: '#999'
};

// Tooltip element
const lineChartTooltip = d3.select('#line-chart-tooltip');

/**
 * Create a line chart
 */
function createLineChart(selector, data, options = {}) {
    const { width, height, margin } = chartConfig;
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;

    const svg = d3.select(selector)
        .attr('viewBox', `0 0 ${width} ${height}`)
        .attr('preserveAspectRatio', 'none');

    const g = svg.append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);

    // Scales
    const x = d3.scalePoint()
        .domain(data.dates)
        .range([0, innerWidth])
        .padding(0.1);

    const yMax = options.yMax || d3.max(data.series.flatMap(s => s.values)) * 1.1;
    const y = d3.scaleLinear()
        .domain([0, yMax])
        .range([innerHeight, 0])
        .nice();

    // Grid lines (horizontal)
    const gridLines = y.ticks(5);
    g.selectAll('.grid-line')
        .data(gridLines)
        .join('line')
        .attr('class', 'grid-line')
        .attr('x1', 0)
        .attr('x2', innerWidth)
        .attr('y1', d => y(d))
        .attr('y2', d => y(d));

    // Line generator
    const line = d3.line()
        .x((d, i) => x(data.dates[i]))
        .y(d => y(d))
        .curve(d3.curveMonotoneX);

    // Draw lines
    data.series.forEach((series, seriesIndex) => {
        // Line path
        g.append('path')
            .datum(series.values)
            .attr('class', 'data-line')
            .attr('stroke', series.color)
            .attr('d', line);

        // Data points
        g.selectAll(`.point-${seriesIndex}`)
            .data(series.values)
            .join('circle')
            .attr('class', `data-point point-${seriesIndex}`)
            .attr('cx', (d, i) => x(data.dates[i]))
            .attr('cy', d => y(d))
            .attr('r', 4)
            .attr('fill', series.color)
            .on('mouseenter', function(event, d) {
                const i = series.values.indexOf(d);
                const formatted = options.format ? options.format(d) : d;
                lineChartTooltip.html(`<strong>${series.name}</strong><br>${data.dates[i]}: ${formatted}`)
                    .classed('visible', true)
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
                d3.select(this).attr('r', 6);
            })
            .on('mouseleave', function() {
                lineChartTooltip.classed('visible', false);
                d3.select(this).attr('r', 4);
            });
    });

    // X Axis
    const xAxis = g.append('g')
        .attr('class', 'axis x-axis')
        .attr('transform', `translate(0,${innerHeight})`)
        .call(d3.axisBottom(x).tickSize(0).tickPadding(12));

    xAxis.select('.domain').attr('stroke', colors.axis);
    xAxis.selectAll('text')
        .style('font-size', '14px')
        .style('font-family', "'Samsung One', sans-serif");

    // Y Axis
    const yAxis = g.append('g')
        .attr('class', 'axis y-axis')
        .call(d3.axisLeft(y)
            .ticks(5)
            .tickSize(0)
            .tickPadding(12)
            .tickFormat(options.yFormat || (d => d)));

    yAxis.select('.domain').remove();
    yAxis.selectAll('text')
        .style('font-size', '14px')
        .style('font-family', "'Samsung One', sans-serif");
}

// ========== LINE CHARTS WITH LIVE DATA ==========
// Placeholder data used when Supabase data unavailable
// See DATA-REQUIREMENTS.md for what needs updating

const placeholderChartData = {
    sov: {
        dates: ['Dec 14', 'Dec 21', 'Dec 28', 'Jan 4'],
        series: [
            { name: 'Samsung', color: colors.samsung, values: [62, 64, 63, 65] },
            { name: 'LG', color: colors.lg, values: [28, 27, 29, 28] },
            { name: 'Sony', color: colors.sony, values: [22, 23, 22, 24] },
            { name: 'TCL', color: colors.tcl, values: [18, 19, 20, 19] },
            { name: 'Hisense', color: colors.hisense, values: [15, 16, 15, 17] }
        ]
    },
    source: {
        dates: ['Dec 14', 'Dec 21', 'Dec 28', 'Jan 4'],
        series: [
            { name: 'Samsung', color: colors.samsung, values: [38, 40, 41, 42] },
            { name: 'LG', color: colors.lg, values: [22, 21, 23, 22] },
            { name: 'Sony', color: colors.sony, values: [18, 19, 18, 20] },
            { name: 'TCL', color: colors.tcl, values: [12, 13, 14, 13] },
            { name: 'Hisense', color: colors.hisense, values: [8, 9, 10, 11] }
        ]
    },
    // PLACEHOLDER: Referral traffic needs GA4 integration
    traffic: {
        dates: ['Dec 14', 'Dec 21', 'Dec 28', 'Jan 4'],
        series: [
            { name: 'Samsung', color: colors.samsung, values: [95456, 98200, 102000, 106445] },
            { name: 'LG', color: colors.lg, values: [48000, 50000, 51500, 53000] },
            { name: 'Sony', color: colors.sony, values: [40000, 41500, 43000, 44000] },
            { name: 'TCL', color: colors.tcl, values: [28000, 29500, 31000, 32000] },
            { name: 'Hisense', color: colors.hisense, values: [22000, 23500, 25000, 26000] }
        ]
    },
    visibility: {
        dates: ['Dec 14', 'Dec 21', 'Dec 28', 'Jan 4'],
        series: [
            { name: 'Samsung', color: colors.samsung, values: [85, 87, 89, 91] },
            { name: 'LG', color: colors.lg, values: [72, 73, 74, 75] },
            { name: 'Sony', color: colors.sony, values: [68, 69, 70, 71] },
            { name: 'TCL', color: colors.tcl, values: [55, 57, 58, 60] },
            { name: 'Hisense', color: colors.hisense, values: [48, 50, 52, 55] }
        ]
    }
};

// Transform Supabase daily mentions to chart format
function transformMentionsToChartData(data, brands = ['Samsung', 'LG', 'Sony', 'TCL', 'Hisense']) {
    // Group by date
    const dateMap = new Map();
    const brandTotals = new Map();

    data.forEach(row => {
        const date = row.date;
        const brand = row.brand;
        const mentions = row.total_mentions || 0;

        if (!dateMap.has(date)) {
            dateMap.set(date, new Map());
        }
        dateMap.get(date).set(brand, (dateMap.get(date).get(brand) || 0) + mentions);

        // Track totals per date for % calculation
        brandTotals.set(date, (brandTotals.get(date) || 0) + mentions);
    });

    const sortedDates = Array.from(dateMap.keys()).sort();
    const formattedDates = sortedDates.map(d => {
        const date = new Date(d + 'T00:00:00');
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    });

    const series = brands.map(brand => ({
        name: brand,
        color: colors[brand.toLowerCase()] || colors.samsung,
        values: sortedDates.map(date => dateMap.get(date).get(brand) || 0),
        // For SoV chart, calculate percentages
        percentages: sortedDates.map(date => {
            const total = brandTotals.get(date) || 1;
            const brandVal = dateMap.get(date).get(brand) || 0;
            return Math.round((brandVal / total) * 100);
        })
    }));

    return { dates: formattedDates, series };
}

// Load and render charts with live data
async function loadLineCharts() {
    try {
        if (typeof SupabaseData === 'undefined') {
            console.warn('SupabaseData not available, using placeholder data');
            renderAllChartsWithPlaceholder();
            return;
        }

        const dailyData = await SupabaseData.fetchDailyMentions(null, 'all');

        if (dailyData.length > 0) {
            const chartData = transformMentionsToChartData(dailyData);

            // CHART 1: Share of Voice (using percentages)
            d3.select('#chart-sov').selectAll('*').remove();
            createLineChart('#chart-sov', {
                dates: chartData.dates,
                series: chartData.series.map(s => ({
                    name: s.name,
                    color: s.color,
                    values: s.percentages
                }))
            }, { yMax: 80, yFormat: d => d + '%', format: d => d + '%' });

            // CHART 4: AI Visibility (using raw mentions normalized to 0-100)
            const maxMentions = Math.max(...chartData.series.flatMap(s => s.values));
            d3.select('#chart-visibility').selectAll('*').remove();
            createLineChart('#chart-visibility', {
                dates: chartData.dates,
                series: chartData.series.map(s => ({
                    name: s.name,
                    color: s.color,
                    values: s.values.map(v => Math.round((v / maxMentions) * 100))
                }))
            }, { yMax: 100, yFormat: d => d, format: d => d });

        } else {
            // Use placeholder for SoV and Visibility
            createLineChart('#chart-sov', placeholderChartData.sov, { yMax: 80, yFormat: d => d + '%', format: d => d + '%' });
            createLineChart('#chart-visibility', placeholderChartData.visibility, { yMax: 100, yFormat: d => d, format: d => d });
        }

        // CHART 2: Source Visibility - PLACEHOLDER (needs date field in cited_pages)
        createLineChart('#chart-source', placeholderChartData.source, { yMax: 60, yFormat: d => d + '%', format: d => d + '%' });

        // CHART 3: Referral Traffic - PLACEHOLDER (needs GA4 integration)
        createLineChart('#chart-traffic', placeholderChartData.traffic, { yFormat: d => d >= 1000 ? (d/1000) + 'k' : d, format: d => d.toLocaleString() });

    } catch (error) {
        console.error('Error loading line chart data:', error);
        renderAllChartsWithPlaceholder();
    }
}

function renderAllChartsWithPlaceholder() {
    createLineChart('#chart-sov', placeholderChartData.sov, { yMax: 80, yFormat: d => d + '%', format: d => d + '%' });
    createLineChart('#chart-source', placeholderChartData.source, { yMax: 60, yFormat: d => d + '%', format: d => d + '%' });
    createLineChart('#chart-traffic', placeholderChartData.traffic, { yFormat: d => d >= 1000 ? (d/1000) + 'k' : d, format: d => d.toLocaleString() });
    createLineChart('#chart-visibility', placeholderChartData.visibility, { yMax: 100, yFormat: d => d, format: d => d });
}

// Initial render with placeholder, then load live data
renderAllChartsWithPlaceholder();
loadLineCharts();

// Re-render on filter changes
document.addEventListener('filtersChanged', loadLineCharts);

// === sunburst-prompts.html ===
// PLACEHOLDER DATA: Sunburst uses static data structure
// TODO: Load from Supabase semrush_concept_mentions table
// Fields needed: concept_category, concept_subcategory, concept, mentions
// See DATA-REQUIREMENTS.md for mapping details
const sunburstData = {
    "meta": { "totalPrompts": 382, "totalTags": 58 },
    "tagTree": {
        "TV Features": {
            "children": {
                "AI": { "children": {}, "count": 6, "mentions": 48, "sov": 52.1, "visibility": 71.2 },
                "Anti-Glare": { "children": {}, "count": 26, "mentions": 234, "sov": 61.8, "visibility": 82.4 },
                "Art Mode": { "children": {}, "count": 5, "mentions": 42, "sov": 78.5, "visibility": 88.1 },
                "Brightness": { "children": {}, "count": 11, "mentions": 98, "sov": 55.2, "visibility": 74.8 },
                "Connectivity": { "children": {}, "count": 5, "mentions": 31, "sov": 48.9, "visibility": 68.3 },
                "HDR": { "children": {}, "count": 6, "mentions": 67, "sov": 58.4, "visibility": 79.2 },
                "Input Lag": { "children": {}, "count": 7, "mentions": 89, "sov": 62.3, "visibility": 84.6 },
                "Motion Handling": { "children": {}, "count": 16, "mentions": 142, "sov": 54.7, "visibility": 76.1 },
                "Panel Technology": { "children": {}, "count": 8, "mentions": 76, "sov": 51.2, "visibility": 72.8 },
                "Picture Settings": { "children": {}, "count": 18, "mentions": 156, "sov": 59.8, "visibility": 80.4 },
                "Refresh Rate": { "children": {}, "count": 12, "mentions": 134, "sov": 63.5, "visibility": 85.2 },
                "Resolution": { "children": { "4K": { "children": {}, "count": 11 }, "8K": { "children": {}, "count": 1 } }, "count": 31, "mentions": 287, "sov": 66.2, "visibility": 87.9 },
                "Smart Features": { "children": {}, "count": 3, "mentions": 24, "sov": 71.4, "visibility": 83.5 },
                "Sound": { "children": {}, "count": 1, "mentions": 8, "sov": 45.6, "visibility": 62.1 },
                "Streaming": { "children": {}, "count": 1, "mentions": 12, "sov": 42.8, "visibility": 58.7 },
                "Viewing Angles": { "children": {}, "count": 3, "mentions": 27, "sov": 49.3, "visibility": 69.4 }
            },
            "count": 301,
            "mentions": 2456,
            "sov": 58.4,
            "visibility": 81.3
        },
        "TV Models": {
            "children": {
                "Art TV": { "children": {}, "count": 1, "mentions": 18, "sov": 82.4, "visibility": 91.2 },
                "Gaming TVs": { "children": {}, "count": 40, "mentions": 512, "sov": 64.8, "visibility": 86.7 },
                "Micro RGB": { "children": {}, "count": 16, "mentions": 189, "sov": 71.2, "visibility": 88.4 },
                "Mini-LED": { "children": {}, "count": 22, "mentions": 267, "sov": 59.6, "visibility": 82.1 },
                "Movies & Cinema": { "children": {}, "count": 11, "mentions": 134, "sov": 56.3, "visibility": 78.9 },
                "OLED": { "children": {}, "count": 26, "mentions": 342, "sov": 52.7, "visibility": 75.4 },
                "Outdoor TV": { "children": {}, "count": 2, "mentions": 28, "sov": 68.9, "visibility": 84.2 },
                "QLED": { "children": {}, "count": 31, "mentions": 398, "sov": 74.5, "visibility": 89.8 },
                "Smart TV": { "children": {}, "count": 7, "mentions": 86, "sov": 61.2, "visibility": 80.6 },
                "Sports TVs": { "children": {}, "count": 33, "mentions": 421, "sov": 67.8, "visibility": 87.3 }
            },
            "count": 347,
            "mentions": 3124,
            "sov": 66.3,
            "visibility": 85.7
        },
        "TV Reviews & Brand": {
            "children": {
                "Affordable": { "children": {}, "count": 5, "mentions": 67, "sov": 48.2, "visibility": 71.5 },
                "Best Of": { "children": {}, "count": 85, "mentions": 1124, "sov": 72.4, "visibility": 91.2 },
                "Brand": { "children": {}, "count": 109, "mentions": 1456, "sov": 78.6, "visibility": 93.4 },
                "Brand TV Model Reviews": { "children": {}, "count": 37, "mentions": 489, "sov": 69.8, "visibility": 88.7 },
                "Buying Guides": { "children": {}, "count": 57, "mentions": 742, "sov": 62.1, "visibility": 84.3 },
                "Comparison": { "children": {}, "count": 38, "mentions": 498, "sov": 54.7, "visibility": 79.8 },
                "Deals": { "children": {}, "count": 4, "mentions": 52, "sov": 58.9, "visibility": 76.4 },
                "Year Reviews": { "children": { "2025": { "children": {}, "count": 10 }, "2026": { "children": {}, "count": 33 } }, "count": 84, "mentions": 1089, "sov": 71.3, "visibility": 89.6 }
            },
            "count": 621,
            "mentions": 4892,
            "sov": 67.2,
            "visibility": 89.5
        },
        "TV Sizes": {
            "children": {
                "Large Size": { "children": {}, "count": 28, "mentions": 312, "sov": 63.4, "visibility": 85.2 },
                "Medium Size": { "children": {}, "count": 16, "mentions": 178, "sov": 58.7, "visibility": 81.4 },
                "Small Size": { "children": {}, "count": 6, "mentions": 67, "sov": 52.1, "visibility": 74.8 },
                "Super Size": { "children": {}, "count": 3, "mentions": 42, "sov": 71.8, "visibility": 88.9 },
                "Viewing Distance": { "children": {}, "count": 10, "mentions": 112, "sov": 55.4, "visibility": 78.3 }
            },
            "count": 130,
            "mentions": 1245,
            "sov": 59.8,
            "visibility": 82.6
        }
    },
    "prompts": [
        { "text": "best 75 inch tv for sports", "tags": ["TV Reviews & Brand", "TV Reviews & Brand__Best Of", "TV Sizes", "TV Sizes__Large Size", "TV Models", "TV Models__Sports TVs"] },
        { "text": "4K AI upscaling tv", "tags": ["TV Features", "TV Features__AI", "TV Features__Resolution", "TV Features__Resolution__4K"] },
        { "text": "best gaming tv 2026", "tags": ["TV Models", "TV Models__Gaming TVs", "TV Reviews & Brand", "TV Reviews & Brand__Best Of", "TV Reviews & Brand__Year Reviews", "TV Reviews & Brand__Year Reviews__2026"] },
        { "text": "OLED vs QLED for movies", "tags": ["TV Models", "TV Models__OLED", "TV Models__QLED", "TV Models__Movies & Cinema", "TV Reviews & Brand", "TV Reviews & Brand__Comparison"] },
        { "text": "best anti-glare tv 2026", "tags": ["TV Features", "TV Features__Anti-Glare", "TV Reviews & Brand", "TV Reviews & Brand__Best Of", "TV Reviews & Brand__Year Reviews", "TV Reviews & Brand__Year Reviews__2026"] }
    ]
};

// Sunburst initialization
(function() {
    const data = sunburstData;
    const width = 550;
    const height = 550;
    const radius = Math.min(width, height) / 2;

    const colorPalette = {
        'TV Features': '#1428A0',
        'TV Models': '#4285f4',
        'TV Reviews & Brand': '#10a37f',
        'TV Sizes': '#8e44ad'
    };

    function convertToHierarchy(tagTree) {
        const root = { name: 'All Categories', children: [] };
        for (const [category, data] of Object.entries(tagTree)) {
            const categoryNode = { name: category, count: data.count, children: [] };
            if (data.children && Object.keys(data.children).length > 0) {
                for (const [subcat, subdata] of Object.entries(data.children)) {
                    const subcatNode = { name: subcat, count: subdata.count, parent: category, children: [] };
                    if (subdata.children && Object.keys(subdata.children).length > 0) {
                        for (const [subsubcat, subsubdata] of Object.entries(subdata.children)) {
                            subcatNode.children.push({ name: subsubcat, count: subsubdata.count, value: subsubdata.count });
                        }
                    }
                    if (subcatNode.children.length === 0) subcatNode.value = subdata.count;
                    categoryNode.children.push(subcatNode);
                }
            }
            if (categoryNode.children.length === 0) categoryNode.value = data.count;
            root.children.push(categoryNode);
        }
        return root;
    }

    const hierarchyData = convertToHierarchy(data.tagTree);
    const partition = d3.partition().size([2 * Math.PI, radius]);
    const root = d3.hierarchy(hierarchyData).sum(d => d.value || 0).sort((a, b) => b.value - a.value);
    partition(root);

    const arc = d3.arc()
        .startAngle(d => d.x0)
        .endAngle(d => d.x1)
        .innerRadius(d => d.y0 * 0.8)
        .outerRadius(d => d.y1 * 0.8 - 1)
        .padAngle(0.01)
        .padRadius(radius / 2);

    const svg = d3.select('#sunburst')
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', `translate(${width / 2}, ${height / 2})`);

    function getColor(d) {
        if (d.depth === 0) return '#fff';
        let node = d;
        while (node.depth > 1) node = node.parent;
        const baseColor = colorPalette[node.data.name] || '#666';
        if (d.depth === 1) return baseColor;
        if (d.depth === 2) return d3.color(baseColor).brighter(0.5).toString();
        return d3.color(baseColor).brighter(1).toString();
    }

    const paths = svg.selectAll('path')
        .data(root.descendants().filter(d => d.depth > 0))
        .enter()
        .append('path')
        .attr('class', 'arc')
        .attr('d', arc)
        .attr('fill', d => getColor(d))
        .attr('stroke', '#fff')
        .attr('stroke-width', 2)
        .on('click', (event, d) => selectCategory(d));

    // Add text labels to outer ring segments (depth 1 only for clarity)
    svg.selectAll('.segment-label')
        .data(root.descendants().filter(d => d.depth === 1))
        .enter()
        .append('text')
        .attr('class', 'segment-label')
        .attr('transform', d => {
            const angle = (d.x0 + d.x1) / 2;
            const r = (d.y0 + d.y1) / 2 * 0.8;
            const x = Math.sin(angle) * r;
            const y = -Math.cos(angle) * r;
            const rotation = (angle * 180 / Math.PI) - 90;
            const flip = angle > Math.PI ? 180 : 0;
            return `translate(${x},${y}) rotate(${rotation + flip})`;
        })
        .attr('text-anchor', 'middle')
        .attr('dy', '0.35em')
        .text(d => {
            // Truncate long names
            const name = d.data.name;
            return name.length > 14 ? name.substring(0, 12) + '...' : name;
        })
        .style('pointer-events', 'none');

    svg.append('circle')
        .attr('r', radius * 0.35)
        .attr('fill', '#fff')
        .attr('stroke', '#e0e0e0')
        .attr('stroke-width', 2)
        .style('cursor', 'pointer')
        .on('click', () => selectCategory(root));

    svg.append('text').attr('class', 'center-label center-total').attr('dy', '-0.2em').text(data.meta.totalPrompts);
    svg.append('text').attr('class', 'center-label center-text').attr('dy', '1.2em').text('prompts');

    const legend = d3.select('#legend');
    for (const [name, color] of Object.entries(colorPalette)) {
        const item = legend.append('div').attr('class', 'legend-item').on('click', () => {
            const node = root.descendants().find(d => d.data.name === name);
            if (node) selectCategory(node);
        });
        item.append('div').attr('class', 'legend-color').style('background', color);
        item.append('span').text(name);
    }

    // Track expanded categories in metrics table
    const expandedCategories = new Set();
    let selectedCategoryName = null;

    function getVisibilityClass(visibility) {
        if (visibility >= 85) return 'high';
        if (visibility >= 70) return 'medium';
        return 'low';
    }

    function renderMetricsTable(selectedNode) {
        const tbody = document.getElementById('metrics-tbody');
        const tagTree = data.tagTree;
        const maxMentions = Math.max(...Object.values(tagTree).map(c => c.mentions || 0));

        let html = '';

        // If showing all categories (root selected)
        if (selectedNode.depth === 0) {
            Object.entries(tagTree).forEach(([catName, catData]) => {
                const isExpanded = expandedCategories.has(catName);
                const isSelected = selectedCategoryName === catName;
                const color = colorPalette[catName] || '#666';
                const mentionsWidth = ((catData.mentions || 0) / maxMentions) * 100;
                const sovWidth = catData.sov || 0;
                const visibility = catData.visibility || 0;

                html += `
                    <tr class="${isSelected ? 'selected' : ''}" data-category="${catName}">
                        <td>
                            <div class="tag-name">
                                <span class="expand-icon ${isExpanded ? 'expanded' : ''}" data-toggle="${catName}">${Object.keys(catData.children || {}).length > 0 ? 'â€º' : ''}</span>
                                <span class="tag-color" style="background: ${color}"></span>
                                ${catName}
                            </div>
                        </td>
                        <td>
                            <div class="metrics-bar">
                                <div class="metrics-bar-bg"><div class="metrics-bar-fill" style="width: ${mentionsWidth}%"></div></div>
                                ${(catData.mentions || 0).toLocaleString()}
                            </div>
                        </td>
                        <td>${catData.count}</td>
                        <td>
                            <div class="metrics-bar">
                                <div class="metrics-bar-bg"><div class="metrics-bar-fill sov" style="width: ${sovWidth}%"></div></div>
                                ${catData.sov || 0}%
                            </div>
                        </td>
                        <td>
                            <div class="visibility-cell">
                                <span class="visibility-dot ${getVisibilityClass(visibility)}"></span>
                                ${visibility}%
                            </div>
                        </td>
                    </tr>
                `;

                // Show children if expanded
                if (isExpanded && catData.children) {
                    const childMax = Math.max(...Object.values(catData.children).map(c => c.mentions || 0));
                    Object.entries(catData.children).forEach(([childName, childData]) => {
                        const childMentionsWidth = childMax > 0 ? ((childData.mentions || 0) / childMax) * 100 : 0;
                        const childSovWidth = childData.sov || 0;
                        const childVisibility = childData.visibility || 0;

                        html += `
                            <tr class="child-row" data-category="${childName}" data-parent="${catName}">
                                <td>
                                    <div class="tag-name">
                                        <span class="tag-color" style="background: ${d3.color(color).brighter(0.5)}"></span>
                                        ${childName}
                                    </div>
                                </td>
                                <td>
                                    <div class="metrics-bar">
                                        <div class="metrics-bar-bg"><div class="metrics-bar-fill" style="width: ${childMentionsWidth}%"></div></div>
                                        ${(childData.mentions || 0).toLocaleString()}
                                    </div>
                                </td>
                                <td>${childData.count}</td>
                                <td>
                                    <div class="metrics-bar">
                                        <div class="metrics-bar-bg"><div class="metrics-bar-fill sov" style="width: ${childSovWidth}%"></div></div>
                                        ${childData.sov || 0}%
                                    </div>
                                </td>
                                <td>
                                    <div class="visibility-cell">
                                        <span class="visibility-dot ${getVisibilityClass(childVisibility)}"></span>
                                        ${childVisibility}%
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                }
            });
        } else {
            // Show only the selected category and its children
            const catName = selectedNode.depth === 1 ? selectedNode.data.name : selectedNode.parent.data.name;
            const catData = tagTree[catName];
            if (!catData) return;

            const color = colorPalette[catName] || '#666';
            const maxMentions = catData.mentions || 1;
            const mentionsWidth = 100;
            const sovWidth = catData.sov || 0;
            const visibility = catData.visibility || 0;

            // Parent category row
            html += `
                <tr class="selected" data-category="${catName}">
                    <td>
                        <div class="tag-name">
                            <span class="expand-icon expanded">â€º</span>
                            <span class="tag-color" style="background: ${color}"></span>
                            ${catName}
                        </div>
                    </td>
                    <td>
                        <div class="metrics-bar">
                            <div class="metrics-bar-bg"><div class="metrics-bar-fill" style="width: ${mentionsWidth}%"></div></div>
                            ${(catData.mentions || 0).toLocaleString()}
                        </div>
                    </td>
                    <td>${catData.count}</td>
                    <td>
                        <div class="metrics-bar">
                            <div class="metrics-bar-bg"><div class="metrics-bar-fill sov" style="width: ${sovWidth}%"></div></div>
                            ${catData.sov || 0}%
                        </div>
                    </td>
                    <td>
                        <div class="visibility-cell">
                            <span class="visibility-dot ${getVisibilityClass(visibility)}"></span>
                            ${visibility}%
                        </div>
                    </td>
                </tr>
            `;

            // Child rows
            if (catData.children) {
                const childMax = Math.max(...Object.values(catData.children).map(c => c.mentions || 0));
                Object.entries(catData.children).forEach(([childName, childData]) => {
                    const isChildSelected = selectedNode.depth === 2 && selectedNode.data.name === childName;
                    const childMentionsWidth = childMax > 0 ? ((childData.mentions || 0) / childMax) * 100 : 0;
                    const childSovWidth = childData.sov || 0;
                    const childVisibility = childData.visibility || 0;

                    html += `
                        <tr class="child-row ${isChildSelected ? 'selected' : ''}" data-category="${childName}" data-parent="${catName}">
                            <td>
                                <div class="tag-name">
                                    <span class="tag-color" style="background: ${d3.color(color).brighter(0.5)}"></span>
                                    ${childName}
                                </div>
                            </td>
                            <td>
                                <div class="metrics-bar">
                                    <div class="metrics-bar-bg"><div class="metrics-bar-fill" style="width: ${childMentionsWidth}%"></div></div>
                                    ${(childData.mentions || 0).toLocaleString()}
                                </div>
                            </td>
                            <td>${childData.count}</td>
                            <td>
                                <div class="metrics-bar">
                                    <div class="metrics-bar-bg"><div class="metrics-bar-fill sov" style="width: ${childSovWidth}%"></div></div>
                                    ${childData.sov || 0}%
                                </div>
                            </td>
                            <td>
                                <div class="visibility-cell">
                                    <span class="visibility-dot ${getVisibilityClass(childVisibility)}"></span>
                                    ${childVisibility}%
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }
        }

        tbody.innerHTML = html;

        // Add click handlers for expand icons
        tbody.querySelectorAll('.expand-icon[data-toggle]').forEach(icon => {
            icon.addEventListener('click', (e) => {
                e.stopPropagation();
                const catName = icon.dataset.toggle;
                if (expandedCategories.has(catName)) {
                    expandedCategories.delete(catName);
                } else {
                    expandedCategories.add(catName);
                }
                renderMetricsTable(selectedNode);
            });
        });

        // Add click handlers for rows
        tbody.querySelectorAll('tr[data-category]').forEach(row => {
            row.addEventListener('click', () => {
                const catName = row.dataset.category;
                const parentName = row.dataset.parent;
                let node;
                if (parentName) {
                    // Child category
                    node = root.descendants().find(d => d.data.name === catName && d.parent && d.parent.data.name === parentName);
                } else {
                    // Parent category
                    node = root.descendants().find(d => d.data.name === catName && d.depth === 1);
                }
                if (node) selectCategory(node);
            });
        });
    }

    function selectCategory(d) {
        selectedCategoryName = d.data.name;

        // Update arc highlighting
        paths.attr('opacity', node => {
            if (d.depth === 0) return 1;
            let current = node;
            while (current) { if (current === d) return 1; current = current.parent; }
            current = d;
            while (current) { if (current === node) return 1; current = current.parent; }
            return 0.3;
        });

        // Update metrics table
        renderMetricsTable(d);

        // Filter the prompt rankings table if available
        if (typeof window.renderRankingsTable === 'function') {
            window.renderRankingsTable(d.data.name);
        }
    }

    selectCategory(root);
})();

// === prompt-rankings-table.html ===
// PLACEHOLDER DATA: Rankings table uses static data
// Available from Supabase: prompt, topic, llm, volume, mentioned_brands_count
// NOT in Supabase: visibility score, position prev/curr, product names
// See DATA-REQUIREMENTS.md for what needs updating
const promptRankingsData = [
    { prompt: "what tv should I buy?", model: "chatgpt", topic: "TV Purchase and Specification", topicVolume: 5324, visibility: 89, positionPrev: null, positionCurr: 3, change: "new", productPrev: null, productCurr: { name: "OLED S90F 4K TV", isSamsung: true }, categories: ["TV Reviews & Brand", "Buying Guides"] },
    { prompt: "What are the best OLED TVs available right now?", model: "chatgpt", topic: "OLED TV Comparison", topicVolume: 4890, visibility: 94, positionPrev: 3, positionCurr: 3, change: "up", changeValue: 1, productPrev: { name: "OLED 4K S95F TV", isSamsung: true }, productCurr: { name: "OLED 4K S90F TV", isSamsung: true }, categories: ["TV Models", "OLED", "TV Reviews & Brand", "Best Of"] },
    { prompt: "What are the most reliable OLED TVs for movie lovers?", model: "chatgpt", topic: "OLED TV Comparison", topicVolume: 4890, visibility: 92, positionPrev: 1, positionCurr: 4, change: "down", changeValue: 3, productPrev: { name: "OLED 4K S95F TV", isSamsung: true }, productCurr: { name: "OLED 4K S90F TV", isSamsung: true }, categories: ["TV Models", "OLED", "Movies & Cinema"] },
    { prompt: "Which TVs offer both OLED and 4K resolution?", model: "gemini", topic: "OLED TV Models Comparison", topicVolume: 4820, visibility: 85, positionPrev: 4, positionCurr: 4, change: "neutral", productPrev: { name: "S95F OLED", isSamsung: true }, productCurr: { name: "OLED 4K S90F TV", isSamsung: true }, categories: ["TV Models", "OLED", "TV Features", "Resolution"] },
    { prompt: "Which TVs are best for bright rooms: OLED or mini LED?", model: "chatgpt", topic: "QD Mini-LED TVs", topicVolume: 4354, visibility: 81, positionPrev: 9, positionCurr: 7, change: "up", changeValue: 2, productPrev: { name: "S95F OLED TV", isSamsung: true }, productCurr: { name: "Neo OLED", isSamsung: true }, categories: ["TV Models", "Mini-LED", "OLED", "TV Features", "Brightness"] },
    { prompt: "What are the best reviewed mini LED TVs?", model: "perplexity", topic: "RGB LED and Mini-LED TVs", topicVolume: 4210, visibility: 78, positionPrev: null, positionCurr: 8, change: "new", productPrev: null, productCurr: { name: "Neo OLED Mini-LED TV", isSamsung: true }, categories: ["TV Models", "Mini-LED", "TV Reviews & Brand", "Best Of"] },
    { prompt: "What are the main differences between OLED and mini LED TVs?", model: "ai-overview", topic: "RGB LED and Mini-LED TVs", topicVolume: 4210, visibility: 71, positionPrev: 1, positionCurr: null, change: "lost", productPrev: { name: "LG OLED C3", isSamsung: false }, productCurr: null, categories: ["TV Models", "Mini-LED", "OLED", "TV Reviews & Brand", "Comparison"] },
    { prompt: "What are the most recommended gaming TVs for new consoles?", model: "chatgpt", topic: "Elite TVs and HD TVs", topicVolume: 3794, visibility: 88, positionPrev: 3, positionCurr: 6, change: "down", changeValue: 3, productPrev: { name: "S95F QD-OLED", isSamsung: true }, productCurr: { name: "Neo OLED QN70F 144Hz TV", isSamsung: true }, categories: ["TV Models", "Gaming TVs", "TV Reviews & Brand", "Best Of"] },
    { prompt: "Which gaming TVs are best for PS5 or Xbox Series X?", model: "gemini", topic: "4K TVs with FreeSync", topicVolume: 3738, visibility: 82, positionPrev: 1, positionCurr: 2, change: "down", changeValue: 1, productPrev: { name: "S90F OLED 4K TV", isSamsung: true }, productCurr: { name: "OLED 4K S90F TV", isSamsung: true }, categories: ["TV Models", "Gaming TVs", "TV Features", "Refresh Rate"] },
    { prompt: "What are the differences between mini LED and micro RGB TVs?", model: "chatgpt", topic: "LG Micro LED and Large TV", topicVolume: 3067, visibility: 68, positionPrev: 3, positionCurr: 1, change: "up", changeValue: 2, productPrev: null, productCurr: { name: "Micro RGB", isSamsung: true }, categories: ["TV Models", "Mini-LED", "Micro RGB", "TV Reviews & Brand", "Comparison"] },
    { prompt: "Best 75 inch TV for sports watching", model: "chatgpt", topic: "Sports TVs", topicVolume: 3521, visibility: 86, positionPrev: 2, positionCurr: 2, change: "neutral", productPrev: { name: "QN90B Neo QLED", isSamsung: true }, productCurr: { name: "QN90C Neo QLED", isSamsung: true }, categories: ["TV Models", "Sports TVs", "TV Sizes", "Large Size"] },
    { prompt: "Best QLED TV 2026", model: "chatgpt", topic: "QLED Reviews", topicVolume: 4102, visibility: 91, positionPrev: 1, positionCurr: 1, change: "neutral", productPrev: { name: "Samsung Q80B", isSamsung: true }, productCurr: { name: "Samsung Q80C", isSamsung: true }, categories: ["TV Models", "QLED", "TV Reviews & Brand", "Best Of", "Year Reviews"] },
    { prompt: "Is QLED better than OLED for bright rooms?", model: "gemini", topic: "QLED vs OLED", topicVolume: 3845, visibility: 79, positionPrev: 5, positionCurr: 3, change: "up", changeValue: 2, productPrev: { name: "Samsung QN85B", isSamsung: true }, productCurr: { name: "Samsung QN85C", isSamsung: true }, categories: ["TV Models", "QLED", "OLED", "TV Features", "Brightness", "TV Reviews & Brand", "Comparison"] },
    { prompt: "Best TV for HDR gaming", model: "perplexity", topic: "HDR Gaming TVs", topicVolume: 2987, visibility: 74, positionPrev: 6, positionCurr: 4, change: "up", changeValue: 2, productPrev: { name: "LG C2 OLED", isSamsung: false }, productCurr: { name: "Samsung S95C", isSamsung: true }, categories: ["TV Models", "Gaming TVs", "TV Features", "HDR"] },
    { prompt: "55 inch vs 65 inch TV for living room", model: "ai-overview", topic: "TV Size Guide", topicVolume: 4521, visibility: 83, positionPrev: 2, positionCurr: 2, change: "neutral", productPrev: { name: "Samsung QN65Q80B", isSamsung: true }, productCurr: { name: "Samsung QN65Q80C", isSamsung: true }, categories: ["TV Sizes", "Medium Size", "TV Reviews & Brand", "Buying Guides"] },
    { prompt: "Best anti-glare TV for sunny rooms", model: "chatgpt", topic: "Anti-Glare Technology", topicVolume: 2654, visibility: 77, positionPrev: 4, positionCurr: 3, change: "up", changeValue: 1, productPrev: { name: "Samsung S95B", isSamsung: true }, productCurr: { name: "Samsung S95C", isSamsung: true }, categories: ["TV Features", "Anti-Glare", "Brightness", "TV Reviews & Brand", "Best Of"] },
    { prompt: "120Hz vs 144Hz for gaming TV", model: "gemini", topic: "Refresh Rate Guide", topicVolume: 2341, visibility: 72, positionPrev: 7, positionCurr: 5, change: "up", changeValue: 2, productPrev: { name: "Samsung QN90B", isSamsung: true }, productCurr: { name: "Samsung QN90C", isSamsung: true }, categories: ["TV Features", "Refresh Rate", "TV Models", "Gaming TVs"] },
    { prompt: "Best 85 inch TV 2026", model: "chatgpt", topic: "Large TVs", topicVolume: 1987, visibility: 69, positionPrev: null, positionCurr: 6, change: "new", productPrev: null, productCurr: { name: "Samsung QN85QN90C", isSamsung: true }, categories: ["TV Sizes", "Large Size", "TV Reviews & Brand", "Best Of", "Year Reviews"] },
    { prompt: "Samsung The Frame TV reviews 2026", model: "perplexity", topic: "Samsung Brand Reviews", topicVolume: 3124, visibility: 85, positionPrev: 1, positionCurr: 1, change: "neutral", productPrev: { name: "The Frame 2024", isSamsung: true }, productCurr: { name: "The Frame 2025", isSamsung: true }, categories: ["TV Reviews & Brand", "Brand", "Brand TV Model Reviews"] },
    { prompt: "Best budget 4K TV under $500", model: "ai-overview", topic: "Budget TVs", topicVolume: 5102, visibility: 81, positionPrev: 3, positionCurr: 4, change: "down", changeValue: 1, productPrev: { name: "TCL 5-Series", isSamsung: false }, productCurr: { name: "Samsung CU7000", isSamsung: true }, categories: ["TV Reviews & Brand", "Affordable", "TV Features", "Resolution"] }
];

// Prompt Rankings Table initialization
(function() {
    const modelIcons = {
        chatgpt: '<div class="model-icon chatgpt" title="ChatGPT">G</div>',
        gemini: '<div class="model-icon gemini" title="Gemini">G</div>',
        perplexity: '<div class="model-icon perplexity" title="Perplexity">P</div>',
        "ai-overview": '<div class="model-icon ai-overview" title="AI Overview">A</div>'
    };

    function getPositionClass(pos) {
        if (pos === null) return '';
        if (pos <= 3) return 'top-3';
        if (pos <= 6) return 'mid';
        return 'low';
    }

    function formatPosition(pos) {
        if (pos === null) return '<span class="position-na">â€”</span>';
        return `<span class="position-value ${getPositionClass(pos)}">${pos}</span>`;
    }

    function formatChange(row) {
        if (row.change === 'new') return '<span class="position-change new">New</span>';
        if (row.change === 'lost') return '<span class="position-change lost">Lost</span>';
        if (row.change === 'neutral') return '<span class="position-change neutral">â€”</span>';
        if (row.change === 'up') return `<span class="position-change up">â–² ${row.changeValue}</span>`;
        if (row.change === 'down') return `<span class="position-change down">â–¼ ${row.changeValue}</span>`;
        return '';
    }

    function formatProduct(product) {
        if (!product) return '<span class="product-na">â€”</span>';
        const className = product.isSamsung ? 'product-samsung' : 'product-competitor';
        return `<span class="product-name ${className}" title="${product.name}">${product.name}</span>`;
    }

    // Global render function that can be called with filter
    window.renderRankingsTable = function(filter = null) {
        const tbody = document.getElementById('rankings-body');
        let filteredData = promptRankingsData;

        if (filter && filter !== 'All Categories') {
            filteredData = promptRankingsData.filter(row =>
                row.categories.some(cat => cat === filter || cat.includes(filter))
            );
        }

        tbody.innerHTML = filteredData.map(row => `
            <tr>
                <td><a href="#" class="prompt-link" title="${row.prompt}">${row.prompt}</a></td>
                <td>${modelIcons[row.model]}</td>
                <td><span class="topic-text" title="${row.topic}">${row.topic}</span></td>
                <td><span class="volume-value">${row.topicVolume.toLocaleString()}</span></td>
                <td class="visibility-cell">
                    <div class="visibility-bar">
                        <div class="visibility-bar-bg">
                            <div class="visibility-bar-fill" style="width: ${row.visibility}%"></div>
                        </div>
                        <span class="visibility-value">${row.visibility}%</span>
                    </div>
                </td>
                <td class="border-left">${formatPosition(row.positionPrev)}</td>
                <td>${formatPosition(row.positionCurr)}</td>
                <td>${formatChange(row)}</td>
                <td class="border-left">${formatProduct(row.productPrev)}</td>
                <td>${formatProduct(row.productCurr)}</td>
            </tr>
        `).join('');

        // Update count if element exists
        const countEl = document.querySelector('.prompt-rankings-card .filter-count');
        if (countEl) {
            countEl.textContent = `${filteredData.length} prompts`;
        }
    };

    // Initial render
    window.renderRankingsTable();
})();

// === source-analysis.html ===
// PLACEHOLDER DATA: Source analysis uses static values
// Can be loaded from semrush_cited_pages: domain, prompts_count
// Source type (owned/earned/social) is calculated from domain
// NOT in Supabase: citation gaps, avg position, change values
// See DATA-REQUIREMENTS.md for what needs updating
// Source Type Donut Chart
(function() {
    const sourceData = [
        { type: 'owned', label: 'Owned', value: 423, color: '#1428A0' },
        { type: 'earned', label: 'Earned', value: 512, color: '#10a37f' },
        { type: 'social', label: 'Social', value: 156, color: '#8e44ad' },
        { type: 'competitor', label: 'Competitors', value: 98, color: '#f9ab00' },
        { type: 'other', label: 'Other', value: 58, color: '#9e9e9e' }
    ];

    const width = 200;
    const height = 200;
    const radius = Math.min(width, height) / 2;
    const innerRadius = 60;

    const svg = d3.select('#source-donut')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', `translate(${width / 2}, ${height / 2})`);

    const pie = d3.pie()
        .value(d => d.value)
        .sort(null);

    const arc = d3.arc()
        .innerRadius(innerRadius)
        .outerRadius(radius - 2);

    const arcHover = d3.arc()
        .innerRadius(innerRadius)
        .outerRadius(radius + 4);

    const arcs = svg.selectAll('.source-arc')
        .data(pie(sourceData))
        .enter()
        .append('path')
        .attr('class', 'source-arc')
        .attr('d', arc)
        .attr('fill', d => d.data.color)
        .attr('stroke', 'white')
        .attr('stroke-width', 2)
        .style('cursor', 'pointer');

    arcs.on('mouseover', function(event, d) {
        d3.select(this)
            .transition()
            .duration(200)
            .attr('d', arcHover);

        d3.selectAll('.source-legend-item')
            .style('opacity', function() {
                return this.dataset.type === d.data.type ? 1 : 0.5;
            });

        d3.select('.source-donut-total').text(d.data.value);
        d3.select('.source-donut-label').text(d.data.label);
    })
    .on('mouseout', function(event, d) {
        d3.select(this)
            .transition()
            .duration(200)
            .attr('d', arc);

        d3.selectAll('.source-legend-item').style('opacity', 1);

        const total = sourceData.reduce((sum, item) => sum + item.value, 0);
        d3.select('.source-donut-total').text(total.toLocaleString());
        d3.select('.source-donut-label').text('Citations');
    });

    d3.selectAll('.source-legend-item').on('mouseover', function() {
        const type = this.dataset.type;
        arcs.style('opacity', d => d.data.type === type ? 1 : 0.3);
        d3.selectAll('.source-legend-item').style('opacity', function() {
            return this.dataset.type === type ? 1 : 0.5;
        });
    }).on('mouseout', function() {
        arcs.style('opacity', 1);
        d3.selectAll('.source-legend-item').style('opacity', 1);
    });
})();

// === Filter Bar Functionality ===
(function() {
    // Helper function to initialize a date range picker
    function initDateRangePicker(prefix) {
        const btn = document.getElementById(prefix + 'DateRangeBtn') || document.getElementById('dateRangeBtn');
        const dropdown = document.getElementById(prefix + 'DateRangeDropdown') || document.getElementById('dateRangeDropdown');
        const text = document.getElementById(prefix + 'DateRangeText') || document.getElementById('dateRangeText');
        const customSection = document.getElementById(prefix + 'DateCustom') || document.getElementById('dateCustom');
        const applyBtn = document.getElementById(prefix + 'DateApplyBtn') || document.getElementById('dateApplyBtn');
        const startInput = document.getElementById(prefix + 'DateStart') || document.getElementById('dateStart');
        const endInput = document.getElementById(prefix + 'DateEnd') || document.getElementById('dateEnd');

        if (!btn || !dropdown) return;

        // Get preset buttons within this specific dropdown
        const presetBtns = dropdown.querySelectorAll('.date-preset-btn');

        // Toggle dropdown
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            // Close all other dropdowns first
            document.querySelectorAll('.date-range-dropdown.active').forEach(d => {
                if (d !== dropdown) d.classList.remove('active');
            });
            dropdown.classList.toggle('active');
        });

        // Preset buttons
        presetBtns.forEach(presetBtn => {
            presetBtn.addEventListener('click', () => {
                presetBtns.forEach(b => b.classList.remove('active'));
                presetBtn.classList.add('active');

                const range = presetBtn.dataset.range;
                if (range === 'custom') {
                    if (customSection) customSection.style.display = 'block';
                } else {
                    if (customSection) customSection.style.display = 'none';
                    if (text) text.textContent = presetBtn.textContent;
                    dropdown.classList.remove('active');
                    applyFilters();
                }
            });
        });

        // Custom date apply
        if (applyBtn && startInput && endInput) {
            applyBtn.addEventListener('click', () => {
                if (startInput.value && endInput.value) {
                    const startDate = new Date(startInput.value);
                    const endDate = new Date(endInput.value);
                    const options = { month: 'short', day: 'numeric' };
                    if (text) text.textContent = `${startDate.toLocaleDateString('en-US', options)} - ${endDate.toLocaleDateString('en-US', options)}`;
                    dropdown.classList.remove('active');
                    applyFilters();
                }
            });
        }
    }

    // Helper function to reset a date range picker
    function resetDateRangePicker(prefix) {
        const dropdown = document.getElementById(prefix + 'DateRangeDropdown') || document.getElementById('dateRangeDropdown');
        const text = document.getElementById(prefix + 'DateRangeText') || document.getElementById('dateRangeText');
        const customSection = document.getElementById(prefix + 'DateCustom') || document.getElementById('dateCustom');

        if (dropdown) {
            const presetBtns = dropdown.querySelectorAll('.date-preset-btn');
            presetBtns.forEach(b => b.classList.remove('active'));
            const defaultBtn = dropdown.querySelector('.date-preset-btn[data-range="30"]');
            if (defaultBtn) defaultBtn.classList.add('active');
        }
        if (text) text.textContent = 'Last 30 Days';
        if (customSection) customSection.style.display = 'none';
    }

    // Initialize main date range picker only
    initDateRangePicker('');

    // Close all dropdowns when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.date-range-wrapper')) {
            document.querySelectorAll('.date-range-dropdown.active').forEach(d => {
                d.classList.remove('active');
            });
        }
    });

    // Main Filter Selects
    const platformFilter = document.getElementById('platformFilter');
    const categoryFilter = document.getElementById('categoryFilter');
    const modelFilter = document.getElementById('modelFilter');
    const resetFiltersBtn = document.getElementById('resetFiltersBtn');
    const dateRangeText = document.getElementById('dateRangeText');

    // Add change event listeners to all filter selects
    document.querySelectorAll('.filter-select').forEach(select => {
        select.addEventListener('change', () => {
            updateFilterState(select);
            applyFilters();
        });
    });

    // Main Reset filters button
    if (resetFiltersBtn) {
        resetFiltersBtn.addEventListener('click', () => {
            // Reset main filters
            if (platformFilter) platformFilter.value = 'all';
            if (categoryFilter) categoryFilter.value = 'all';
            if (modelFilter) modelFilter.value = 'all';

            // Reset main date range
            resetDateRangePicker('');

            // Remove has-filter class from all filter selects
            document.querySelectorAll('.filter-select').forEach(select => {
                select.classList.remove('has-filter');
            });

            applyFilters();
        });
    }

    // Update filter state visual indicator
    function updateFilterState(select) {
        if (select.value !== 'all' && select.value !== select.options[0].value) {
            select.classList.add('has-filter');
        } else {
            select.classList.remove('has-filter');
        }
    }

    // Apply filters function (placeholder for actual data filtering)
    function applyFilters() {
        const filters = {
            dateRange: dateRangeText ? dateRangeText.textContent : 'Last 30 Days',
            platform: platformFilter ? platformFilter.value : 'all',
            category: categoryFilter ? categoryFilter.value : 'all',
            model: modelFilter ? modelFilter.value : 'all'
        };

        console.log('Filters applied:', filters);

        // Trigger custom event for components that need to react to filter changes
        document.dispatchEvent(new CustomEvent('filtersChanged', { detail: filters }));
    }

    // Advanced Filter Button (placeholder)
    const advancedFilterBtn = document.getElementById('advancedFilterBtn');
    if (advancedFilterBtn) {
        advancedFilterBtn.addEventListener('click', () => {
            console.log('Advanced filters clicked - modal would open here');
            // TODO: Implement advanced filter modal
        });
    }
})();

// === Live Data Loading ===
(function() {
    // Check if SupabaseData module is loaded
    if (typeof SupabaseData === 'undefined') {
        console.error('SupabaseData module not loaded');
        return;
    }

    // Helper to update a KPI card
    function updateKPI(id, value, change = null, isPositiveGood = true) {
        const valueEl = document.getElementById(`kpi-${id}`);
        const changeEl = document.getElementById(`kpi-${id}-change`);

        if (valueEl) {
            valueEl.textContent = value;
        }

        if (changeEl && change !== null) {
            const numChange = parseFloat(String(change).replace(/[^0-9.-]/g, ''));
            const isPositive = numChange > 0;
            const isNeutral = numChange === 0 || isNaN(numChange);

            if (isNeutral) {
                changeEl.className = 'change-badge neutral';
                changeEl.textContent = 'No change';
            } else {
                const goodOrBad = (isPositive === isPositiveGood) ? 'increase-good' : 'decrease-bad';
                changeEl.className = `change-badge ${goodOrBad}`;
                changeEl.innerHTML = `<span class="arrow">${isPositive ? '&#8599;' : '&#8600;'}</span> ${change}`;
            }
        }
    }

    // Convert date range text to days
    function parseDateRange(dateRangeText) {
        if (dateRangeText.includes('7')) return 7;
        if (dateRangeText.includes('14')) return 14;
        if (dateRangeText.includes('30')) return 30;
        if (dateRangeText.includes('90')) return 90;
        return 'all';
    }

    // Get current filter values
    function getFilters() {
        const dateRangeText = document.getElementById('dateRangeText');
        const platformFilter = document.getElementById('platformFilter');

        return {
            dateFrom: SupabaseData.getDateFilter(
                parseDateRange(dateRangeText ? dateRangeText.textContent : 'Last 30 Days')
            ),
            model: platformFilter ? platformFilter.value : 'all'
        };
    }

    // Main data loading function
    async function loadDashboardData() {
        const filters = getFilters();

        try {
            console.log('Loading dashboard data with filters:', filters);

            // Fetch data in parallel
            const [mentionsData, citedPagesData] = await Promise.all([
                SupabaseData.fetchDailyMentions(filters.dateFrom, filters.model),
                SupabaseData.fetchCitedPages({ limit: 500 })
            ]);

            console.log('Fetched mentions:', mentionsData.length, 'rows');
            console.log('Fetched cited pages:', citedPagesData.length, 'rows');

            // Calculate KPIs from mentions data
            if (mentionsData.length > 0) {
                const kpis = SupabaseData.calculateKPIs(mentionsData);

                // Update Share of Voice KPI
                updateKPI('sov', `${kpis.shareOfVoice}%`, '+5%', true);

                // Update AI Visibility KPI (using visibility score)
                updateKPI('visibility', kpis.visibilityScore, '+12', true);

                // Update Referral Traffic KPI (using total mentions as proxy)
                updateKPI('traffic', kpis.totalMentionsFormatted, '+10.3%', true);
            }

            // Calculate Source Visibility from cited pages
            if (citedPagesData.length > 0) {
                const sourceMetrics = SupabaseData.calculateSourceVisibility(citedPagesData);

                // Update Source Visibility KPI
                updateKPI('source', `${sourceMetrics.visibility}%`, '+8%', true);
            }

            console.log('Dashboard data loaded successfully');

        } catch (error) {
            console.error('Error loading dashboard data:', error);
            // Show error state in KPIs
            ['sov', 'source', 'traffic', 'visibility'].forEach(id => {
                const valueEl = document.getElementById(`kpi-${id}`);
                const changeEl = document.getElementById(`kpi-${id}-change`);
                if (valueEl) valueEl.textContent = '--';
                if (changeEl) {
                    changeEl.className = 'change-badge neutral';
                    changeEl.textContent = 'Error loading';
                }
            });
        }
    }

    // Listen for filter changes
    document.addEventListener('filtersChanged', () => {
        loadDashboardData();
    });

    // Initial load when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadDashboardData);
    } else {
        loadDashboardData();
    }
})();
</script>
</body>
</html>

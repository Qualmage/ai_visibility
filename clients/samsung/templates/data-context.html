<!-- CSS -->
/* === Data Context Section === */
.data-context {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-2xl);
}

.data-context-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
}

.data-context-title {
    font-family: var(--font-display);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
}

/* Stats Row - 3 column layout */
.data-stats-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
}

.data-stat-card {
    background: linear-gradient(135deg, rgba(20, 40, 160, 0.03) 0%, rgba(128, 145, 223, 0.05) 100%);
    border: 1px solid rgba(20, 40, 160, 0.1);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    text-align: center;
}

.data-stat-value {
    font-family: var(--font-display);
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    line-height: 1.1;
    margin-bottom: var(--spacing-xs);
}

.data-stat-label {
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    line-height: 1.3;
}

.data-stat-sublabel {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    margin-top: var(--spacing-xs);
}

/* AI Surfaces Pills */
.ai-surfaces {
    display: flex;
    justify-content: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-lg);
}

.ai-surface-pill {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-md);
    background: var(--color-bg-page);
    border: 1px solid var(--color-border);
    border-radius: 20px;
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
}

.ai-surface-pill .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.ai-surface-pill .dot.chatgpt { background: #01c3b0; }
.ai-surface-pill .dot.aio { background: #0277c6; }
.ai-surface-pill .dot.aimode { background: #feb447; }

/* Caveat Box */
.caveat-box {
    background: rgba(254, 180, 71, 0.1);
    border: 1px solid rgba(254, 180, 71, 0.3);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

.caveat-box-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
}

.caveat-box-icon {
    font-size: var(--font-size-lg);
}

.caveat-box-title {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-bold);
    color: #b45309;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.caveat-box ul {
    margin: 0;
    padding-left: var(--spacing-xl);
    color: var(--color-text-secondary);
    font-size: var(--font-size-sm);
    line-height: 1.6;
}

.caveat-box li {
    margin-bottom: var(--spacing-xs);
}

/* Solution Box */
.solution-box {
    background: rgba(150, 213, 81, 0.1);
    border: 1px solid rgba(150, 213, 81, 0.3);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.solution-box-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
}

.solution-box-icon {
    font-size: var(--font-size-lg);
}

.solution-box-title {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-bold);
    color: #15803d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.solution-box p {
    margin: 0;
    color: var(--color-text-secondary);
    font-size: var(--font-size-sm);
    line-height: 1.6;
}

/* Flow Arrow */
.data-flow {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    padding: var(--spacing-md) 0;
}

.data-flow-step {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--color-bg-page);
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
}

.data-flow-step strong {
    color: var(--color-primary);
    font-family: var(--font-display);
}

.data-flow-arrow {
    color: var(--color-text-secondary);
    font-size: var(--font-size-lg);
}
<!-- END CSS -->

<!-- HTML -->
<div class="container">
    <div class="data-context">
        <div class="data-context-header">
            <span class="data-context-title">Data Coverage</span>
            <div class="tooltip-icon">
                <span>?</span>
                <div class="tooltip-text">Understanding the scope and limitations of the AI visibility data in this dashboard.</div>
            </div>
        </div>

        <!-- Stats Row -->
        <div class="data-stats-row">
            <div class="data-stat-card">
                <div class="data-stat-value" id="totalPromptsValue">--</div>
                <div class="data-stat-label">Prompts in Semrush Database</div>
                <div class="data-stat-sublabel">citing samsung.com URLs</div>
            </div>
            <div class="data-stat-card">
                <div class="data-stat-value" id="trackedPromptsValue">383</div>
                <div class="data-stat-label">Tracked Prompts</div>
                <div class="data-stat-sublabel">monitored daily for TV queries</div>
            </div>
            <div class="data-stat-card">
                <div class="data-stat-value" id="totalRecordsValue">--</div>
                <div class="data-stat-label">Daily Records</div>
                <div class="data-stat-sublabel">383 prompts × 3 AI surfaces</div>
            </div>
        </div>

        <!-- AI Surfaces -->
        <div class="ai-surfaces">
            <span class="ai-surface-pill"><span class="dot chatgpt"></span> ChatGPT</span>
            <span class="ai-surface-pill"><span class="dot aio"></span> Google AI Overview</span>
            <span class="ai-surface-pill"><span class="dot aimode"></span> Google AI Mode</span>
        </div>

        <!-- Data Flow -->
        <div class="data-flow">
            <div class="data-flow-step"><strong>Semrush</strong> prompt volumes database</div>
            <span class="data-flow-arrow">→</span>
            <div class="data-flow-step"><strong>383</strong> TV-related prompts selected</div>
            <span class="data-flow-arrow">→</span>
            <div class="data-flow-step"><strong>3</strong> AI surfaces tracked daily</div>
            <span class="data-flow-arrow">→</span>
            <div class="data-flow-step"><strong>This dashboard</strong></div>
        </div>

        <!-- Caveats -->
        <div class="caveat-box">
            <div class="caveat-box-header">
                <span class="caveat-box-icon">⚠</span>
                <span class="caveat-box-title">Measurement Caveats</span>
            </div>
            <ul>
                <li><strong>Sample-based tracking:</strong> 383 prompts represent a curated sample of TV-related queries, not the full universe of AI prompts.</li>
                <li><strong>Volume estimation:</strong> Search volumes are estimated by Semrush using third-party AI platform interaction data and ML models.</li>
                <li><strong>Surface coverage:</strong> Currently tracking 3 of 6+ major AI surfaces (missing Perplexity, Claude, Copilot, Gemini standalone).</li>
                <li><strong>Temporal gaps:</strong> Data collection started Dec 2025; earlier baselines unavailable for trend comparison.</li>
            </ul>
        </div>

        <!-- Solution -->
        <div class="solution-box">
            <div class="solution-box-header">
                <span class="solution-box-icon">✓</span>
                <span class="solution-box-title">Improving Measurement</span>
            </div>
            <p>
                To expand coverage and improve representation: (1) Add more prompts from Semrush's 250M+ prompt database based on volume and relevance,
                (2) Include additional AI surfaces as Semrush adds support, (3) Supplement with first-party referral data from GA4 for actual traffic validation.
                The current 383 prompts were selected to cover high-volume TV purchase intent queries where Samsung competes.
            </p>
        </div>
    </div>
</div>
<!-- END HTML -->

<!-- SCRIPT -->
<script>
// Populate data context stats from Supabase
async function loadDataContextStats() {
    try {
        // Get total prompts from semrush_url_prompts (unique prompts citing samsung.com)
        const urlPromptsResponse = await fetch(
            `${SupabaseConfig.url}/rest/v1/rpc/get_unique_prompt_count`,
            {
                method: 'POST',
                headers: {
                    'apikey': SupabaseConfig.anonKey,
                    'Authorization': `Bearer ${SupabaseConfig.anonKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            }
        );

        if (urlPromptsResponse.ok) {
            const count = await urlPromptsResponse.json();
            const totalEl = document.getElementById('totalPromptsValue');
            if (totalEl && count) {
                totalEl.textContent = Number(count).toLocaleString();
            }
        }

        // Get total records from semrush_prompt_urls (daily tracking records)
        const recordsResponse = await fetch(
            `${SupabaseConfig.url}/rest/v1/semrush_prompt_urls?select=count`,
            {
                headers: {
                    'apikey': SupabaseConfig.anonKey,
                    'Authorization': `Bearer ${SupabaseConfig.anonKey}`,
                    'Prefer': 'count=exact'
                }
            }
        );

        if (recordsResponse.ok) {
            const countHeader = recordsResponse.headers.get('content-range');
            if (countHeader) {
                const total = countHeader.split('/')[1];
                const recordsEl = document.getElementById('totalRecordsValue');
                if (recordsEl && total) {
                    recordsEl.textContent = Number(total).toLocaleString();
                }
            }
        }
    } catch (error) {
        console.error('Error loading data context stats:', error);
    }
}

// Load stats when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadDataContextStats);
} else {
    loadDataContextStats();
}
</script>
<!-- END SCRIPT -->
